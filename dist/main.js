(()=>{var Ar=Object.create;var yt=Object.defineProperty;var Or=Object.getOwnPropertyDescriptor;var Er=Object.getOwnPropertyNames,ge=Object.getOwnPropertySymbols,Cr=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty,qr=Object.prototype.propertyIsEnumerable;var ye=(n,r,a)=>r in n?yt(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a,bt=(n,r)=>{for(var a in r||(r={}))we.call(r,a)&&ye(n,a,r[a]);if(ge)for(var a of ge(r))qr.call(r,a)&&ye(n,a,r[a]);return n};var Tr=n=>yt(n,"__esModule",{value:!0});var T=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var Dr=(n,r,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Er(r))!we.call(n,o)&&o!=="default"&&yt(n,o,{get:()=>r[o],enumerable:!(a=Or(r,o))||a.enumerable});return n},Z=n=>Dr(Tr(yt(n!=null?Ar(Cr(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var tt=T((pi,be)=>{"use strict";function at(n,r,a,o,p,l){return{tag:n,key:r,attrs:a,children:o,text:p,dom:l,is:void 0,domSize:void 0,state:void 0,events:void 0,instance:void 0}}at.normalize=function(n){return Array.isArray(n)?at("[",void 0,void 0,at.normalizeChildren(n),void 0,void 0):n==null||typeof n=="boolean"?null:typeof n=="object"?n:at("#",void 0,void 0,String(n),void 0,void 0)};at.normalizeChildren=function(n){for(var r=new Array(n.length),a=0,o=0;o<n.length;o++)r[o]=at.normalize(n[o]),r[o]!==null&&r[o].key!=null&&a++;if(a!==0&&a!==n.length)throw new TypeError(r.includes(null)?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");return r};be.exports=at});var Bt=T((mi,ve)=>{"use strict";var Pr=tt();ve.exports=function(n,r){return n==null||typeof n=="object"&&n.tag==null&&!Array.isArray(n)?r.length===1&&Array.isArray(r[0])&&(r=r[0]):(r=r.length===0&&Array.isArray(n)?n:[n,...r],n=void 0),Pr("",n&&n.key,n,r)}});var vt=T((di,xe)=>{"use strict";xe.exports={}.hasOwnProperty});var Ut=T((gi,Me)=>{"use strict";Me.exports={}});var Gt=T((wi,Re)=>{"use strict";var Sr=Ut();Re.exports=new Map([[Sr,!0]])});var Wt=T((yi,Ee)=>{"use strict";var Lr=tt(),Vr=Bt(),Kt=vt(),Ae=Ut(),zr=Gt(),$r=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,Oe=Object.create(null);function Ir(n){for(var r in n)if(Kt.call(n,r))return!1;return!0}function Fr(n){return n==="value"||n==="checked"||n==="selectedIndex"||n==="selected"}function kr(n){for(var r,a="div",o=[],p={},l=!0;r=$r.exec(n);){var c=r[1],h=r[2];if(c===""&&h!=="")a=h;else if(c==="#")p.id=h;else if(c===".")o.push(h);else if(r[3][0]==="["){var m=r[6];m&&(m=m.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?o.push(m):(p[r[4]]=m===""?m:m||!0,Fr(r[4])&&(l=!1))}}return o.length>0&&(p.className=o.join(" ")),Ir(p)?p=Ae:zr.set(p,l),Oe[n]={tag:a,attrs:p,is:p.is}}function Nr(n,r){r.tag=n.tag;var a=r.attrs;if(a==null)return r.attrs=n.attrs,r.is=n.is,r;if(Kt.call(a,"class")&&(a.class!=null&&(a.className=a.class),a.class=null),n.attrs!==Ae){var o=a.className;a=Object.assign({},n.attrs,a),n.attrs.className!=null&&(a.className=o!=null?String(n.attrs.className)+" "+String(o):n.attrs.className)}return n.tag==="input"&&Kt.call(a,"type")&&(a=Object.assign({type:a.type},a)),r.is=a.is,r.attrs=a,r}function jr(n,r,...a){if(n==null||typeof n!="string"&&typeof n!="function"&&typeof n.view!="function")throw Error("The selector must be either a string or a component.");var o=Vr(r,a);return typeof n=="string"&&(o.children=Lr.normalizeChildren(o.children),n!=="[")?Nr(Oe[n]||kr(n),o):(o.attrs==null&&(o.attrs={}),o.tag=n,o)}Ee.exports=jr});var qe=T((bi,Ce)=>{"use strict";var _r=tt();Ce.exports=function(n){return n==null&&(n=""),_r("<",void 0,void 0,n,void 0,void 0)}});var De=T((vi,Te)=>{"use strict";var Hr=tt(),Br=Bt();Te.exports=function(n,...r){var a=Br(n,r);return a.attrs==null&&(a.attrs={}),a.tag="[",a.children=Hr.normalizeChildren(a.children),a}});var Se=T((xi,Pe)=>{"use strict";var Xt=Wt();Xt.trust=qe();Xt.fragment=De();Pe.exports=Xt});var Qt=T((Mi,Le)=>{"use strict";Le.exports=new WeakMap});var Yt=T((Ri,ze)=>{"use strict";var Ve=Qt();function*Ur(n){var r=n.dom,a=n.domSize,o=Ve.get(r);if(r!=null)do{var p=r.nextSibling;Ve.get(r)===o&&(yield r,a--),r=p}while(a)}ze.exports=Ur});var Fe=T((Ai,Ie)=>{"use strict";var Jt=tt(),Gr=Qt(),Zt=Yt(),$e=Gt();Ie.exports=function(){var n={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},r,a;function o(e){return e.ownerDocument}function p(e){return e.attrs&&e.attrs.xmlns||n[e.tag]}function l(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function c(e){var t=e.state;try{return this.apply(t,arguments)}finally{l(e,t)}}function h(e){try{return o(e).activeElement}catch(t){return null}}function m(e,t,i,s,u,f,R){for(var O=i;O<s;O++){var d=t[O];d!=null&&g(e,d,u,R,f)}}function g(e,t,i,s,u){var f=t.tag;if(typeof f=="string")switch(t.state={},t.attrs!=null&&$t(t.attrs,t,i),f){case"#":y(e,t,u);break;case"<":$(e,t,s,u);break;case"[":w(e,t,i,s,u);break;default:F(e,t,i,s,u)}else X(e,t,i,s,u)}function y(e,t,i){t.dom=o(e).createTextNode(t.children),Q(e,t.dom,i)}var x={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function $(e,t,i,s){var u=t.children.match(/^\s*?<(\w+)/im)||[],f=o(e).createElement(x[u[1]]||"div");i==="http://www.w3.org/2000/svg"?(f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",f=f.firstChild):f.innerHTML=t.children,t.dom=f.firstChild,t.domSize=f.childNodes.length;for(var R=o(e).createDocumentFragment(),O;O=f.firstChild;)R.appendChild(O);Q(e,R,s)}function w(e,t,i,s,u){var f=o(e).createDocumentFragment();if(t.children!=null){var R=t.children;m(f,R,0,R.length,i,null,s)}t.dom=f.firstChild,t.domSize=f.childNodes.length,Q(e,f,u)}function F(e,t,i,s,u){var f=t.tag,R=t.attrs,O=t.is;s=p(t)||s;var d=s?O?o(e).createElementNS(s,f,{is:O}):o(e).createElementNS(s,f):O?o(e).createElement(f,{is:O}):o(e).createElement(f);if(t.dom=d,R!=null&&wr(t,R,s),Q(e,d,u),!oe(t)&&t.children!=null){var E=t.children;m(d,E,0,E.length,i,null,s),t.tag==="select"&&R!=null&&br(t,R)}}function rt(e,t){var i;if(typeof e.tag.view=="function"){if(e.state=Object.create(e.tag),i=e.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(e.state=void 0,i=e.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,e.state=e.tag.prototype!=null&&typeof e.tag.prototype.view=="function"?new e.tag(e):e.tag(e)}if($t(e.state,e,t),e.attrs!=null&&$t(e.attrs,e,t),e.instance=Jt.normalize(c.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function X(e,t,i,s,u){rt(t,i),t.instance!=null?(g(e,t.instance,i,s,u),t.dom=t.instance.dom,t.domSize=t.instance.domSize):t.domSize=0}function G(e,t,i,s,u,f){if(!(t===i||t==null&&i==null))if(t==null||t.length===0)m(e,i,0,i.length,s,u,f);else if(i==null||i.length===0)ht(e,t,0,t.length);else{var R=t[0]!=null&&t[0].key!=null,O=i[0]!=null&&i[0].key!=null,d=0,E=0;if(!R)for(;E<t.length&&t[E]==null;)E++;if(!O)for(;d<i.length&&i[d]==null;)d++;if(R!==O)ht(e,t,E,t.length),m(e,i,d,i.length,s,u,f);else if(O){for(var H=t.length-1,k=i.length-1,wt,B,z,j,D,kt;H>=E&&k>=d&&(j=t[H],D=i[k],j.key===D.key);)j!==D&&C(e,j,D,s,u,f),D.dom!=null&&(u=D.dom),H--,k--;for(;H>=E&&k>=d&&(B=t[E],z=i[d],B.key===z.key);)E++,d++,B!==z&&C(e,B,z,s,nt(t,E,u),f);for(;H>=E&&k>=d&&!(d===k||B.key!==D.key||j.key!==z.key);)kt=nt(t,E,u),it(e,j,kt),j!==z&&C(e,j,z,s,kt,f),++d<=--k&&it(e,B,u),B!==D&&C(e,B,D,s,u,f),D.dom!=null&&(u=D.dom),E++,H--,j=t[H],D=i[k],B=t[E],z=i[d];for(;H>=E&&k>=d&&j.key===D.key;)j!==D&&C(e,j,D,s,u,f),D.dom!=null&&(u=D.dom),H--,k--,j=t[H],D=i[k];if(d>k)ht(e,t,E,H+1);else if(E>H)m(e,i,d,k+1,s,u,f);else{var Rr=u,de=k-d+1,mt=new Array(de),Nt=0,L=0,jt=2147483647,_t=0,wt,Ht;for(L=0;L<de;L++)mt[L]=-1;for(L=k;L>=d;L--){wt==null&&(wt=A(t,E,H+1)),D=i[L];var ot=wt[D.key];ot!=null&&(jt=ot<jt?ot:-1,mt[L-d]=ot,j=t[ot],t[ot]=null,j!==D&&C(e,j,D,s,u,f),D.dom!=null&&(u=D.dom),_t++)}if(u=Rr,_t!==H-E+1&&ht(e,t,E,H+1),_t===0)m(e,i,d,k+1,s,u,f);else if(jt===-1)for(Ht=J(mt),Nt=Ht.length-1,L=k;L>=d;L--)z=i[L],mt[L-d]===-1?g(e,z,s,f,u):Ht[Nt]===L-d?Nt--:it(e,z,u),z.dom!=null&&(u=i[L].dom);else for(L=k;L>=d;L--)z=i[L],mt[L-d]===-1&&g(e,z,s,f,u),z.dom!=null&&(u=i[L].dom)}}else{var Ft=t.length<i.length?t.length:i.length;for(d=d<E?d:E;d<Ft;d++)B=t[d],z=i[d],!(B===z||B==null&&z==null)&&(B==null?g(e,z,s,f,nt(t,d+1,u)):z==null?gt(e,B):C(e,B,z,s,nt(t,d+1,u),f));t.length>Ft&&ht(e,t,d,t.length),i.length>Ft&&m(e,i,d,i.length,s,u,f)}}}function C(e,t,i,s,u,f){var R=t.tag,O=i.tag;if(R===O&&t.is===i.is){if(i.state=t.state,i.events=t.events,Mr(i,t))return;if(typeof R=="string")switch(i.attrs!=null&&It(i.attrs,i,s),R){case"#":b(t,i);break;case"<":v(e,t,i,f,u);break;case"[":q(e,t,i,s,u,f);break;default:M(t,i,s,f)}else S(e,t,i,s,u,f)}else gt(e,t),g(e,i,s,f,u)}function b(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function v(e,t,i,s,u){t.children!==i.children?(ue(e,t),$(e,i,s,u)):(i.dom=t.dom,i.domSize=t.domSize)}function q(e,t,i,s,u,f){G(e,t.children,i.children,s,u,f);var R=0,O=i.children;if(i.dom=null,O!=null)for(var d=0;d<O.length;d++){var E=O[d];E!=null&&E.dom!=null&&(i.dom==null&&(i.dom=E.dom),R+=E.domSize||1)}i.domSize=R}function M(e,t,i,s){var u=t.dom=e.dom;s=p(t)||s,(e.attrs!=t.attrs||t.attrs!=null&&!$e.get(t.attrs))&&vr(t,e.attrs,t.attrs,s),oe(t)||G(u,e.children,t.children,i,null,s)}function S(e,t,i,s,u,f){if(i.instance=Jt.normalize(c.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");It(i.state,i,s),i.attrs!=null&&It(i.attrs,i,s),i.instance!=null?(t.instance==null?g(e,i.instance,s,f,u):C(e,t.instance,i.instance,s,u,f),i.dom=i.instance.dom,i.domSize=i.instance.domSize):(t.instance!=null&&gt(e,t.instance),i.domSize=0)}function A(e,t,i){for(var s=Object.create(null);t<i;t++){var u=e[t];if(u!=null){var f=u.key;f!=null&&(s[f]=t)}}return s}var V=[];function J(e){for(var t=[0],i=0,s=0,u=0,f=V.length=e.length,u=0;u<f;u++)V[u]=e[u];for(var u=0;u<f;++u)if(e[u]!==-1){var R=t[t.length-1];if(e[R]<e[u]){V[u]=R,t.push(u);continue}for(i=0,s=t.length-1;i<s;){var O=(i>>>1)+(s>>>1)+(i&s&1);e[t[O]]<e[u]?i=O+1:s=O}e[u]<e[t[i]]&&(i>0&&(V[u]=t[i-1]),t[i]=u)}for(i=t.length,s=t[i-1];i-- >0;)t[i]=s,s=V[s];return V.length=0,t}function nt(e,t,i){for(;t<e.length;t++)if(e[t]!=null&&e[t].dom!=null)return e[t].dom;return i}function it(e,t,i){if(t.dom!=null){var s;if(t.domSize==null||t.domSize===1)s=t.dom;else{s=o(e).createDocumentFragment();for(var u of Zt(t))s.appendChild(u)}Q(e,s,i)}}function Q(e,t,i){i!=null?e.insertBefore(t,i):e.appendChild(t)}function oe(e){if(e.attrs==null||e.attrs.contenteditable==null&&e.attrs.contentEditable==null)return!1;var t=e.children;if(t!=null&&t.length===1&&t[0].tag==="<"){var i=t[0].children;e.dom.innerHTML!==i&&(e.dom.innerHTML=i)}else if(t!=null&&t.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function ht(e,t,i,s){for(var u=i;u<s;u++){var f=t[u];f!=null&&gt(e,f)}}function ce(e,t,i,s){var u=t.state,f=c.call(i.onbeforeremove,t);if(f!=null){var R=a;for(var O of Zt(t))Gr.set(O,R);s.v++,Promise.resolve(f).finally(function(){l(t,u),le(e,t,s)})}}function le(e,t,i){--i.v==0&&(Lt(t),ue(e,t))}function gt(e,t){var i={v:1};typeof t.tag!="string"&&typeof t.state.onbeforeremove=="function"&&ce(e,t,t.state,i),t.attrs&&typeof t.attrs.onbeforeremove=="function"&&ce(e,t,t.attrs,i),le(e,t,i)}function ue(e,t){if(t.dom!=null)if(t.domSize==null||t.domSize===1)e.removeChild(t.dom);else for(var i of Zt(t))e.removeChild(i)}function Lt(e){if(typeof e.tag!="string"&&typeof e.state.onremove=="function"&&c.call(e.state.onremove,e),e.attrs&&typeof e.attrs.onremove=="function"&&c.call(e.attrs.onremove,e),typeof e.tag!="string")e.instance!=null&&Lt(e.instance);else{e.events!=null&&(e.events._=null);var t=e.children;if(Array.isArray(t))for(var i=0;i<t.length;i++){var s=t[i];s!=null&&Lt(s)}}}function wr(e,t,i){for(var s in t)Vt(e,s,null,t[s],i)}function Vt(e,t,i,s,u){if(!(t==="key"||s==null||fe(t)||i===s&&!xr(e,t)&&typeof s!="object")){if(t[0]==="o"&&t[1]==="n")return me(e,t,s);if(t.slice(0,6)==="xlink:")e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),s);else if(t==="style")pe(e.dom,i,s);else if(he(e,t,u)){if(t==="value"){if((e.tag==="input"||e.tag==="textarea")&&e.dom.value===""+s||e.tag==="select"&&i!==null&&e.dom.value===""+s||e.tag==="option"&&i!==null&&e.dom.value===""+s)return;if(e.tag==="input"&&e.attrs.type==="file"&&""+s!=""){console.error("`value` is read-only on file inputs!");return}}e.tag==="input"&&t==="type"?e.dom.setAttribute(t,s):e.dom[t]=s}else typeof s=="boolean"?s?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute(t==="className"?"class":t,s)}}function yr(e,t,i,s){if(!(t==="key"||i==null||fe(t)))if(t[0]==="o"&&t[1]==="n")me(e,t,void 0);else if(t==="style")pe(e.dom,i,null);else if(he(e,t,s)&&t!=="className"&&t!=="title"&&!(t==="value"&&(e.tag==="option"||e.tag==="select"&&e.dom.selectedIndex===-1&&e.dom===h(e.dom)))&&!(e.tag==="input"&&t==="type"))e.dom[t]=null;else{var u=t.indexOf(":");u!==-1&&(t=t.slice(u+1)),i!==!1&&e.dom.removeAttribute(t==="className"?"class":t)}}function br(e,t){if("value"in t)if(t.value===null)e.dom.selectedIndex!==-1&&(e.dom.value=null);else{var i=""+t.value;(e.dom.value!==i||e.dom.selectedIndex===-1)&&(e.dom.value=i)}"selectedIndex"in t&&Vt(e,"selectedIndex",null,t.selectedIndex,void 0)}function vr(e,t,i,s){var u;if(t!=null){t===i&&!$e.has(i)&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major");for(var f in t)(u=t[f])!=null&&(i==null||i[f]==null)&&yr(e,f,u,s)}if(i!=null)for(var f in i)Vt(e,f,t&&t[f],i[f],s)}function xr(e,t){return t==="value"||t==="checked"||t==="selectedIndex"||t==="selected"&&(e.dom===h(e.dom)||e.tag==="option"&&e.dom.parentNode===h(e.dom))}function fe(e){return e==="oninit"||e==="oncreate"||e==="onupdate"||e==="onremove"||e==="onbeforeremove"||e==="onbeforeupdate"}function he(e,t,i){return i===void 0&&(e.tag.indexOf("-")>-1||e.is||t!=="href"&&t!=="list"&&t!=="form"&&t!=="width"&&t!=="height")&&t in e.dom}function pe(e,t,i){if(t!==i)if(i==null)e.style="";else if(typeof i!="object")e.style=i;else if(t==null||typeof t!="object"){e.style="";for(var s in i){var u=i[s];u!=null&&(s.includes("-")?e.style.setProperty(s,String(u)):e.style[s]=String(u))}}else{for(var s in t)t[s]!=null&&i[s]==null&&(s.includes("-")?e.style.removeProperty(s):e.style[s]="");for(var s in i){var u=i[s];u!=null&&(u=String(u))!==String(t[s])&&(s.includes("-")?e.style.setProperty(s,u):e.style[s]=u)}}}function zt(){this._=r}zt.prototype=Object.create(null),zt.prototype.handleEvent=function(e){var t=this["on"+e.type],i;typeof t=="function"?i=t.call(e.currentTarget,e):typeof t.handleEvent=="function"&&t.handleEvent(e);var s=this;s._!=null&&(e.redraw!==!1&&(0,s._)(),i!=null&&typeof i.then=="function"&&Promise.resolve(i).then(function(){s._!=null&&e.redraw!==!1&&(0,s._)()})),i===!1&&(e.preventDefault(),e.stopPropagation())};function me(e,t,i){if(e.events!=null){if(e.events._=r,e.events[t]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(e.events[t]==null&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i):(e.events[t]!=null&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(e.events=new zt,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i)}function $t(e,t,i){typeof e.oninit=="function"&&c.call(e.oninit,t),typeof e.oncreate=="function"&&i.push(c.bind(e.oncreate,t))}function It(e,t,i){typeof e.onupdate=="function"&&i.push(c.bind(e.onupdate,t))}function Mr(e,t){do{if(e.attrs!=null&&typeof e.attrs.onbeforeupdate=="function"){var i=c.call(e.attrs.onbeforeupdate,e,t);if(i!==void 0&&!i)break}if(typeof e.tag!="string"&&typeof e.state.onbeforeupdate=="function"){var i=c.call(e.state.onbeforeupdate,e,t);if(i!==void 0&&!i)break}return!1}while(!1);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}var pt;return function(e,t,i){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(pt!=null&&e.contains(pt))throw new TypeError("Node is currently being rendered to and thus is locked.");var s=r,u=pt,f=[],R=h(e),O=e.namespaceURI;pt=e,r=typeof i=="function"?i:void 0,a={};try{e.vnodes==null&&(e.textContent=""),t=Jt.normalizeChildren(Array.isArray(t)?t:[t]),G(e,e.vnodes,t,f,null,O==="http://www.w3.org/1999/xhtml"?void 0:O),e.vnodes=t,R!=null&&h(e)!==R&&typeof R.focus=="function"&&R.focus();for(var d=0;d<f.length;d++)f[d]()}finally{r=s,pt=u}}}});var te=T((Oi,ke)=>{"use strict";ke.exports=Fe()()});var _e=T((Ei,je)=>{"use strict";var Ne=tt();je.exports=function(n,r,a){var o=[],p=!1,l=-1;function c(){for(l=0;l<o.length;l+=2)try{n(o[l],Ne(o[l+1]),h)}catch(g){a.error(g)}l=-1}function h(){p||(p=!0,r(function(){p=!1,c()}))}h.sync=c;function m(g,y){if(y!=null&&y.view==null&&typeof y!="function")throw new TypeError("m.mount expects a component, not a vnode.");var x=o.indexOf(g);x>=0&&(o.splice(x,2),x<=l&&(l-=2),n(g,[])),y!=null&&(o.push(g,y),n(g,Ne(y),h))}return{mount:m,redraw:h}}});var xt=T((Ci,He)=>{"use strict";var Kr=te();He.exports=_e()(Kr,typeof requestAnimationFrame!="undefined"?requestAnimationFrame:null,typeof console!="undefined"?console:null)});var ee=T((qi,Be)=>{"use strict";Be.exports=function(n){if(Object.prototype.toString.call(n)!=="[object Object]")return"";var r=[];for(var a in n)o(a,n[a]);return r.join("&");function o(p,l){if(Array.isArray(l))for(var c=0;c<l.length;c++)o(p+"["+c+"]",l[c]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var c in l)o(p+"["+c+"]",l[c]);else r.push(encodeURIComponent(p)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}}});var Mt=T((Ti,Ue)=>{"use strict";var Wr=ee();Ue.exports=function(n,r){if(/:([^\/\.-]+)(\.{3})?:/.test(n))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(r==null)return n;var a=n.indexOf("?"),o=n.indexOf("#"),p=o<0?n.length:o,l=a<0?p:a,c=n.slice(0,l),h={};Object.assign(h,r);var m=c.replace(/:([^\/\.-]+)(\.{3})?/g,function(rt,X,G){return delete h[X],r[X]==null?rt:G?r[X]:encodeURIComponent(String(r[X]))}),g=m.indexOf("?"),y=m.indexOf("#"),x=y<0?m.length:y,$=g<0?x:g,w=m.slice(0,$);a>=0&&(w+=n.slice(a,p)),g>=0&&(w+=(a<0?"?":"&")+m.slice(g,x));var F=Wr(h);return F&&(w+=(a<0&&g<0?"?":"&")+F),o>=0&&(w+=n.slice(o)),y>=0&&(w+=(o<0?"":"&")+m.slice(y)),w}});var We=T((Di,Ke)=>{"use strict";var Xr=Mt(),Ge=vt();Ke.exports=function(n,r){function a(l){return new Promise(l)}function o(l,c){return new Promise(function(h,m){l=Xr(l,c.params);var g=c.method!=null?c.method.toUpperCase():"GET",y=c.body,x=(c.serialize==null||c.serialize===JSON.serialize)&&!(y instanceof n.FormData||y instanceof n.URLSearchParams),$=c.responseType||(typeof c.extract=="function"?"":"json"),w=new n.XMLHttpRequest,F=!1,rt=!1,X=w,G,C=w.abort;w.abort=function(){F=!0,C.call(this)},w.open(g,l,c.async!==!1,typeof c.user=="string"?c.user:void 0,typeof c.password=="string"?c.password:void 0),x&&y!=null&&!p(c,"content-type")&&w.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof c.deserialize!="function"&&!p(c,"accept")&&w.setRequestHeader("Accept","application/json, text/*"),c.withCredentials&&(w.withCredentials=c.withCredentials),c.timeout&&(w.timeout=c.timeout),w.responseType=$;for(var b in c.headers)Ge.call(c.headers,b)&&w.setRequestHeader(b,c.headers[b]);w.onreadystatechange=function(v){if(!F&&v.target.readyState===4)try{var q=v.target.status>=200&&v.target.status<300||v.target.status===304||/^file:\/\//i.test(l),M=v.target.response,S;if($==="json"){if(!v.target.responseType&&typeof c.extract!="function")try{M=JSON.parse(v.target.responseText)}catch(J){M=null}}else(!$||$==="text")&&M==null&&(M=v.target.responseText);if(typeof c.extract=="function"?(M=c.extract(v.target,c),q=!0):typeof c.deserialize=="function"&&(M=c.deserialize(M)),q){if(typeof c.type=="function")if(Array.isArray(M))for(var A=0;A<M.length;A++)M[A]=new c.type(M[A]);else M=new c.type(M);h(M)}else{var V=function(){try{S=v.target.responseText}catch(nt){S=M}var J=new Error(S);J.code=v.target.status,J.response=M,m(J)};w.status===0?setTimeout(function(){rt||V()}):V()}}catch(J){m(J)}},w.ontimeout=function(v){rt=!0;var q=new Error("Request timed out");q.code=v.target.status,m(q)},typeof c.config=="function"&&(w=c.config(w,c,l)||w,w!==X&&(G=w.abort,w.abort=function(){F=!0,G.call(this)})),y==null?w.send():typeof c.serialize=="function"?w.send(c.serialize(y)):y instanceof n.FormData||y instanceof n.URLSearchParams?w.send(y):w.send(JSON.stringify(y))})}a.prototype=Promise.prototype,a.__proto__=Promise;function p(l,c){for(var h in l.headers)if(Ge.call(l.headers,h)&&h.toLowerCase()===c)return!0;return!1}return{request:function(l,c){typeof l!="string"?(c=l,l=l.url):c==null&&(c={});var h=o(l,c);if(c.background===!0)return h;var m=0;function g(){--m==0&&typeof r=="function"&&r()}return y(h);function y(x){var $=x.then;return x.constructor=a,x.then=function(){m++;var w=$.apply(x,arguments);return w.then(g,function(F){if(g(),m===0)throw F}),y(w)},x}}}}});var Qe=T((Pi,Xe)=>{"use strict";var Qr=xt();Xe.exports=We()(typeof window!="undefined"?window:null,Qr.redraw)});var re=T((Si,Ye)=>{"use strict";var Yr=/%(?:[0-7]|(?!c[01]|e0%[89]|ed%[ab]|f0%8|f4%[9ab])(?:c|d|(?:e|f[0-4]%[89ab])[\da-f]%[89ab])[\da-f]%[89ab])[\da-f]/gi;Ye.exports=function(n){return String(n).replace(Yr,decodeURIComponent)}});var ie=T((Li,Ze)=>{"use strict";var Je=re();Ze.exports=function(n){if(n===""||n==null)return{};n.charAt(0)==="?"&&(n=n.slice(1));for(var r=n.split("&"),a={},o={},p=0;p<r.length;p++){var l=r[p].split("="),c=Je(l[0]),h=l.length===2?Je(l[1]):"";h==="true"?h=!0:h==="false"&&(h=!1);var m=c.split(/\]\[?|\[/),g=o;c.indexOf("[")>-1&&m.pop();for(var y=0;y<m.length;y++){var x=m[y],$=m[y+1],w=$==""||!isNaN(parseInt($,10));if(x===""){var c=m.slice(0,y).join();a[c]==null&&(a[c]=Array.isArray(g)?g.length:0),x=a[c]++}else if(x==="__proto__")break;if(y===m.length-1)g[x]=h;else{var F=Object.getOwnPropertyDescriptor(g,x);F!=null&&(F=F.value),F==null&&(g[x]=F=w?[]:{}),g=F}}}return o}});var Rt=T((Vi,tr)=>{"use strict";var Jr=ie();tr.exports=function(n){var r=n.indexOf("?"),a=n.indexOf("#"),o=a<0?n.length:a,p=r<0?o:r,l=n.slice(0,p).replace(/\/{2,}/g,"/");return l?l[0]!=="/"&&(l="/"+l):l="/",{path:l,params:r<0?{}:Jr(n.slice(r+1,o))}}});var rr=T((zi,er)=>{"use strict";var Zr=Rt();er.exports=function(n){var r=Zr(n),a=Object.keys(r.params),o=[],p=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,c,h){return c==null?"\\"+l:(o.push({k:c,r:h==="..."}),h==="..."?"(.*)":h==="."?"([^/]+)\\.":"([^/]+)"+(h||""))})+"\\/?$");return function(l){for(var c=0;c<a.length;c++)if(r.params[a[c]]!==l.params[a[c]])return!1;if(!o.length)return p.test(l.path);var h=p.exec(l.path);if(h==null)return!1;for(var c=0;c<o.length;c++)l.params[o[c].k]=o[c].r?h[c+1]:decodeURIComponent(h[c+1]);return!0}}});var ne=T(($i,ar)=>{"use strict";var ir=vt(),nr=/^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$/;ar.exports=function(n,r){var a={};if(r!=null)for(var o in n)ir.call(n,o)&&!nr.test(o)&&r.indexOf(o)<0&&(a[o]=n[o]);else for(var o in n)ir.call(n,o)&&!nr.test(o)&&(a[o]=n[o]);return a}});var lr=T((Ii,cr)=>{"use strict";var ti=tt(),ei=Wt(),ri=re(),sr=Mt(),or=Rt(),ii=rr(),ni=ne();cr.exports=function(n,r){var a=Promise.resolve(),o=!1,p=!1,l=!1,c,h,m,g,y,x,$,w,F={onremove:function(){p=l=!1,n.removeEventListener("popstate",G,!1)},view:function(){var b=ti(y,x.key,x);return g?g.render(b):[b]}},rt=C.SKIP={};function X(){o=!1;var b=n.location.hash;C.prefix[0]!=="#"&&(b=n.location.search+b,C.prefix[0]!=="?"&&(b=n.location.pathname+b,b[0]!=="/"&&(b="/"+b)));var v=ri(b).slice(C.prefix.length),q=or(v);Object.assign(q.params,n.history.state);function M(A){console.error(A),C.set(m,null,{replace:!0})}S(0);function S(A){for(;A<h.length;A++)if(h[A].check(q)){var V=h[A].component,J=h[A].route,nt=V,it=w=function(Q){if(it===w){if(Q===rt)return S(A+1);y=Q!=null&&(typeof Q.view=="function"||typeof Q=="function")?Q:"div",x=q.params,$=v,w=null,g=V.render?V:null,l?r.redraw():(l=!0,r.mount(c,F))}};V.view||typeof V=="function"?(V={},it(nt)):V.onmatch?a.then(function(){return V.onmatch(q.params,v,J)}).then(it,v===m?null:M):it();return}if(v===m)throw new Error("Could not resolve default route "+m+".");C.set(m,null,{replace:!0})}}function G(){o||(o=!0,setTimeout(X))}function C(b,v,q){if(!b)throw new TypeError("DOM element being rendered to does not exist.");if(h=Object.keys(q).map(function(S){if(S[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(S))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:S,component:q[S],check:ii(S)}}),m=v,v!=null){var M=or(v);if(!h.some(function(S){return S.check(M)}))throw new ReferenceError("Default route doesn't match any known routes.")}c=b,n.addEventListener("popstate",G,!1),p=!0,X()}return C.set=function(b,v,q){if(w!=null&&(q=q||{},q.replace=!0),w=null,b=sr(b,v),p){G();var M=q?q.state:null,S=q?q.title:null;q&&q.replace?n.history.replaceState(M,S,C.prefix+b):n.history.pushState(M,S,C.prefix+b)}else n.location.href=C.prefix+b},C.get=function(){return $},C.prefix="#!",C.Link={view:function(b){var v=ei(b.attrs.selector||"a",ni(b.attrs,["options","params","selector","onclick"]),b.children),q,M,S;return(v.attrs.disabled=Boolean(v.attrs.disabled))?(v.attrs.href=null,v.attrs["aria-disabled"]="true"):(q=b.attrs.options,M=b.attrs.onclick,S=sr(v.attrs.href,b.attrs.params),v.attrs.href=C.prefix+S,v.attrs.onclick=function(A){var V;typeof M=="function"?V=M.call(A.currentTarget,A):M==null||typeof M!="object"||typeof M.handleEvent=="function"&&M.handleEvent(A),V!==!1&&!A.defaultPrevented&&(A.button===0||A.which===0||A.which===1)&&(!A.currentTarget.target||A.currentTarget.target==="_self")&&!A.ctrlKey&&!A.metaKey&&!A.shiftKey&&!A.altKey&&(A.preventDefault(),A.redraw=!1,C.set(S,null,q))}),v}},C.param=function(b){return x&&b!=null?x[b]:x},C}});var fr=T((Fi,ur)=>{"use strict";var ai=xt();ur.exports=lr()(typeof window!="undefined"?window:null,ai)});var Y=T((ki,pr)=>{"use strict";var At=Se(),hr=xt(),si=Qe(),oi=fr(),N=function(){return At.apply(this,arguments)};N.m=At;N.trust=At.trust;N.fragment=At.fragment;N.Fragment="[";N.mount=hr.mount;N.route=oi;N.render=te();N.redraw=hr.redraw;N.request=si.request;N.parseQueryString=ie();N.buildQueryString=ee();N.parsePathname=Rt();N.buildPathname=Mt();N.vnode=tt();N.censor=ne();N.domFor=Yt();pr.exports=N});var P=Z(Y());var U=Z(Y());var dt=Z(Y()),_=class{view(r){return r.attrs.a?(0,dt.default)("a",bt({class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`},r.attrs.a),[(0,dt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label]):(0,dt.default)("button",{class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`,onclick:r.attrs.onclick,title:r.attrs.title||r.attrs.label,disabled:r.attrs.disabled},[(0,dt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label])}};var ae=Z(Y());function ci(n){let r=Math.floor(n/1e3),a=Math.floor(r/60),o=r%60,p=`${o<10?"0":""}${o}`;return`${a>0?`${a<10?"0":""}${a}`:"00"}:${p}`}var ct=class{view(r){return(0,ae.default)("span.tag.is-small",[(0,ae.default)("img",{src:"https://icongr.am/octicons/clock.svg?size=16&color=333333"}),ci(r.attrs.duration)])}};var Ot=Z(Y()),K=class{view(r){return(0,Ot.default)("section",{class:"view"},[(0,Ot.default)("section",bt({class:`content ${r.attrs.contentClass||""}`},r.attrs.contentProps||{}),r.children),(0,Ot.default)("section",{class:"actions"},r.attrs.actions)])}};function li(n){return n<1024?"1 KB":(n=Math.round(n/1024),n<1024?`${n} KB`:`${Math.floor(n/1024*100)/100} MB`)}function lt(n,r){return String(n).padStart(r,"0")}var Et=class{constructor(r){this.app=r.attrs.app,this.gif=r.attrs.gif}view(){let r=new Date,a=`Recording ${lt(r.getFullYear(),4)}-${lt(r.getMonth()+1,2)}-${lt(r.getDate(),2)} at ${lt(r.getHours(),2)}.${lt(r.getMinutes(),2)}.${lt(r.getSeconds(),2)}.gif`,o=[(0,U.default)(_,{label:"Download",icon:"download",a:{href:this.gif.url,download:a,target:"_blank"},primary:!0}),(0,U.default)(_,{label:"Edit",icon:"pencil",onclick:()=>this.app.editGif()}),(0,U.default)(_,{label:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,U.default)(K,{actions:o},(0,U.default)(".recording-card",[(0,U.default)("a",{href:this.gif.url,download:a,target:"_blank"},[(0,U.default)("img.recording",{src:this.gif.url})]),(0,U.default)("footer",[(0,U.default)(ct,{duration:this.gif.duration}),(0,U.default)("span.tag.is-small",[(0,U.default)("a.recording-detail",{href:this.gif.url,download:a,target:"_blank"},[(0,U.default)("img",{src:"https://icongr.am/octicons/download.svg?size=16&color=333333"}),li(this.gif.size)])])])]))]}};var I=Z(Y());function ut(n,r,a=0,o=n.length-1){let p=o-a;if(p===0)return a;if(p===1)return r<n[o].timestamp?a:o;let l=Math.floor((o+a)/2),c=n[l].timestamp;return r===c?l:r<c?ut(n,r,a,l):ut(n,r,l,o)}var se=()=>null,W=window.devicePixelRatio||1,Ct=class{constructor(r){this.didDraw=!1;this.didResize=!1;var p,l;this.app=r.attrs.app,this.recording=r.attrs.recording,this.duration=this.recording.frames[this.recording.frames.length-1].timestamp+this.app.frameLength,this.mouse={x:0,y:0},this.viewport={width:0,height:0,top:0,left:0,scale:1};let a=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.start].timestamp:0,o=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.end].timestamp:this.duration;this.playback={head:a,start:a,offset:0,end:o,disposable:se},this.trim={start:a,end:o},this.crop=(l=(p=r.attrs.renderOptions)==null?void 0:p.crop)!=null?l:{top:0,left:0,width:this.recording.width,height:this.recording.height}}get isPlaying(){return this.playback.disposable!==se}async oncreate(r){this.sourceCanvas=r.dom.querySelector("canvas.source"),this.sourceCtx=this.sourceCanvas.getContext("2d"),this.canvas=r.dom.querySelector("canvas.target"),this.ctx=this.canvas.getContext("2d"),this.matrix=this.ctx.getTransform(),this.playbar=r.dom.querySelector(".playbar"),this.content=r.dom.querySelector(".content");let a=()=>this.onDidResize();window.addEventListener("resize",a),this.viewportDisposable=()=>window.removeEventListener("resize",a),this.onDidResize(),this.zoomToFit(),setTimeout(()=>this.play())}zoomToFit(){this.viewport.top=(this.recording.height-this.viewport.height*W)/-2,this.viewport.left=(this.recording.width-this.viewport.width*W)/-2,this.initialScale=Math.max(.1,Math.min(1,this.viewport.width*W*.95/this.recording.width,this.viewport.height*W*.95/this.recording.height))}onDidResize(){let r=Math.floor(this.content.clientWidth),a=Math.floor(this.content.clientHeight);this.viewport.left+=Math.round((r-this.viewport.width)/this.viewport.scale/2),this.viewport.top+=Math.round((a-this.viewport.height)/this.viewport.scale/2),this.viewport.width=r,this.viewport.height=a,this.didResize=!0,I.default.redraw()}onbeforeremove(){this.pause(),this.viewportDisposable()}view(){let r=[(0,I.default)(_,{title:this.isPlaying?"Pause":"Play",iconset:"material",icon:this.isPlaying?"pause":"play",primary:!0,onclick:()=>this.togglePlayPause()}),(0,I.default)(".playbar",[(0,I.default)("input",{type:"range",min:0,max:`${this.duration}`,value:`${this.playback.head}`,disabled:this.isPlaying,oninput:a=>this.onPlaybarInput(a)}),(0,I.default)(".trim-bar",{style:{left:`${this.trim.start*100/this.duration}%`,width:`${(this.trim.end-this.trim.start)*100/this.duration}%`}},[(0,I.default)(".trim-start",{onmousedown:a=>this.onTrimMouseDown("start",a)}),(0,I.default)(".trim-end",{onmousedown:a=>this.onTrimMouseDown("end",a)})])]),(0,I.default)(_,{label:"Render",icon:"gear",onclick:()=>this.startRendering(),primary:!0}),(0,I.default)(_,{title:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,I.default)(K,{actions:r,contentClass:"crop",contentProps:{onmousemove:a=>this.onMouseMove(a),onmousedown:a=>this.onMouseDown(a),oncontextmenu:a=>a.preventDefault()}},[(0,I.default)("canvas",{class:"source",width:this.recording.width,height:this.recording.height}),(0,I.default)("canvas",{class:"target",width:Math.floor(this.viewport.width*W),height:Math.floor(this.viewport.height*W),onwheel:a=>this.onContentWheel(a)})])]}onTrimMouseDown(r,a){a.preventDefault();let o=this.isPlaying,p=this.playback.head;this.pause();let l={width:this.playbar.clientWidth,screenX:a.screenX,head:r==="start"?this.trim.start:this.trim.end,min:r==="start"?0:this.trim.start+this.app.frameLength,max:r==="start"?this.trim.end-this.app.frameLength:this.duration},c=m=>{let g=m.screenX-l.screenX,y=l.head+Math.round(g*this.duration/l.width);this.playback.head=y,this.trim[r]=Math.max(l.min,Math.min(l.max,y)),I.default.redraw()},h=()=>{document.body.removeEventListener("mousemove",c),document.body.removeEventListener("mouseup",h),this.playback.start=this.trim.start,this.playback.end=this.trim.end,o?(this.playback.head=this.trim.start,this.play()):this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,p)),I.default.redraw()};document.body.addEventListener("mousemove",c),document.body.addEventListener("mouseup",h)}onContentWheel(r){r.preventDefault();let a=Math.pow(1.1,-r.deltaY/90);this.setScale(this.viewport.scale*a,this.mouse),this.drawFrame()}setScale(r,a={x:this.viewport.width/2,y:this.viewport.height/2}){r=Math.max(.2,Math.min(3,r));let o=r/this.viewport.scale,l=this.matrix.inverse().transformPoint({x:a.x*W,y:a.y*W});this.ctx.translate(l.x,l.y),this.ctx.scale(o,o),this.ctx.translate(-l.x,-l.y),this.matrix=this.ctx.getTransform(),this.viewport.scale=r}onMouseMove(r){this.mouse.x=r.clientX,this.mouse.y=r.clientY}onMouseDown(r){r.ctrlKey||r.metaKey||r.shiftKey||r.altKey||r.button>0?this.onViewportMove(r):this.onCrop(r)}onCrop(r){let a=this.matrix.inverse(),o=m=>{let g=a.transformPoint({x:m.clientX*W,y:m.clientY*W});return{x:Math.max(Math.min(Math.floor(g.x)-this.viewport.left,this.recording.width),0),y:Math.max(Math.min(Math.floor(g.y)-this.viewport.top,this.recording.height),0)}},p=o(r),l=!1,c=m=>{let g=o(m);this.crop.top=Math.floor(Math.max(0,Math.min(p.y,g.y))),this.crop.left=Math.floor(Math.max(0,Math.min(p.x,g.x))),this.crop.width=Math.floor(Math.min(this.recording.width-this.crop.left,Math.abs(p.x-g.x))),this.crop.height=Math.floor(Math.min(this.recording.height-this.crop.top,Math.abs(p.y-g.y))),l=!0,I.default.redraw()},h=m=>{m.preventDefault(),document.body.removeEventListener("mousemove",c),document.body.removeEventListener("mouseup",h),(!l||this.crop.width<10||this.crop.height<10)&&(this.crop.top=0,this.crop.left=0,this.crop.width=this.recording.width,this.crop.height=this.recording.height),I.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",c),document.body.addEventListener("mouseup",h)}onViewportMove(r){let a=this.matrix.inverse(),o=h=>{let m=a.transformPoint({x:h.clientX*W,y:h.clientY*W});return{x:Math.floor(m.x),y:Math.floor(m.y)}},p={top:this.viewport.top,left:this.viewport.left,point:o(r)},l=h=>{let m=o(h);this.viewport.top=p.top+m.y-p.point.y,this.viewport.left=p.left+m.x-p.point.x,I.default.redraw()},c=h=>{h.preventDefault(),document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",c),I.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",c)}onPlaybarInput(r){this.playback.head=r.target.valueAsNumber;let a=ut(this.recording.frames,this.playback.head);this.ctx.putImageData(this.recording.frames[a].imageData,0,0)}play(){this.playback.disposable();let r;this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let a=()=>{this.playback.head=this.playback.start+(Date.now()-this.playback.offset)%(this.playback.end-this.playback.start),I.default.redraw(),r=requestAnimationFrame(a)};r=requestAnimationFrame(a),this.playback.disposable=()=>cancelAnimationFrame(r)}onupdate(){this.didResize&&(this.ctx.setTransform(this.matrix),this.didResize=!1),this.drawFrame()}drawFrame(){!this.didDraw&&this.initialScale!==1&&this.setScale(this.initialScale);let r=ut(this.recording.frames,this.playback.head);this.sourceCtx.putImageData(this.recording.frames[r].imageData,0,0);let a=this.ctx.getTransform();this.ctx.setTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(a),this.ctx.drawImage(this.sourceCanvas,this.viewport.left,this.viewport.top),(this.crop.top!==0||this.crop.left!==0||this.crop.width!==this.recording.width||this.crop.height!==this.recording.height)&&(this.ctx.beginPath(),this.ctx.moveTo(this.viewport.left,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top),this.ctx.closePath(),this.ctx.moveTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.closePath(),this.ctx.fillStyle="#00000055",this.ctx.fill()),this.didDraw=!0}pause(){this.playback.disposable(),this.playback.disposable=se}togglePlayPause(){this.isPlaying?this.pause():this.play()}startRendering(){this.app.startRendering({trim:{start:ut(this.recording.frames,this.trim.start),end:ut(this.recording.frames,this.trim.end)},crop:this.crop})}};var et=Z(Y());var qt=class{constructor(r){this.startTime=0;this.width=0;this.height=0;this.frames=[];this.app=r.attrs.app,this.captureStream=r.attrs.captureStream}async oncreate(r){let a=r.dom.getElementsByTagName("video")[0],o=r.dom.getElementsByTagName("canvas")[0];a.srcObject=this.captureStream;let p=o.getContext("2d"),l=new Worker("/dist/ticker.js");l.postMessage(this.app.frameLength),l.onmessage=()=>{if(a.videoWidth===0)return;let g=this.startTime===0;if(g){let x=a.videoWidth,$=a.videoHeight;this.startTime=Date.now(),this.width=x,this.height=$,o.width=x,o.height=$}p.drawImage(a,0,0);let y=p.getImageData(0,0,this.width,this.height);this.frames.push({imageData:y,timestamp:g?0:Date.now()-this.startTime})};let c=setInterval(()=>et.default.redraw(),this.app.frameLength),h=this.captureStream.getVideoTracks()[0],m=()=>this.stopRecording();h.addEventListener("ended",m),this._onbeforeremove=()=>{l.terminate(),clearInterval(c),h.removeEventListener("ended",m),h.stop()},et.default.redraw()}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}view(){return[(0,et.default)(K,[(0,et.default)("p",[(0,et.default)(ct,{duration:this.startTime===0?0:Date.now()-this.startTime})]),(0,et.default)(_,{label:"Stop Recording",icon:"square-fill",onclick:()=>this.stopRecording()}),(0,et.default)("canvas.hidden",{width:640,height:480}),(0,et.default)("video.hidden",{autoplay:!0,playsinline:!0})])]}stopRecording(){this.app.stopRecording({width:this.width,height:this.height,frames:this.frames})}};var ft=Z(Y());var Tt=class{constructor(r){this.progress=0;this.app=r.attrs.app,this.recording=r.attrs.recording,this.renderOptions=r.attrs.renderOptions}async oncreate(r){let a=new GifEncoder({width:this.renderOptions.crop.width,height:this.renderOptions.crop.height});a.on("progress",l=>{this.progress=l,ft.default.redraw()}),a.once("finished",l=>{let c=URL.createObjectURL(l),h=this.recording.frames[this.renderOptions.trim.end].timestamp-this.recording.frames[this.renderOptions.trim.start].timestamp+this.app.frameLength;this.app.finishRendering({blob:l,url:c,duration:h,size:l.size})});let o=r.dom.getElementsByTagName("canvas")[0].getContext("2d"),p=l=>{if(l>this.renderOptions.trim.end){this._onbeforeremove=()=>a.abort(),a.render();return}let c=this.recording.frames[l],h=c.imageData;o.putImageData(h,0,0),h=o.getImageData(this.renderOptions.crop.left,this.renderOptions.crop.top,this.renderOptions.crop.width,this.renderOptions.crop.height);let m=l<this.renderOptions.trim.end?this.recording.frames[l+1].timestamp-c.timestamp:this.app.frameLength;a.addFrame(h,m),setTimeout(()=>p(l+1),0)};p(this.renderOptions.trim.start)}view(){let r=[(0,ft.default)(_,{label:"Cancel",icon:"square-fill",onclick:()=>this.app.cancelRendering()})];return[(0,ft.default)(K,{actions:r},[(0,ft.default)("progress",{max:"1",value:this.progress,title:"Rendering..."},`Rendering: ${Math.floor(this.progress*100)}%`),(0,ft.default)("canvas.hidden",{width:this.recording.width,height:this.recording.height})])]}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}};var st=Z(Y());var mr=Z(Y()),Dt=class{view(r){return(0,mr.default)("img",{src:r.attrs.src||"media/onboarding.gif",alt:r.attrs.alt||"Onboarding animation",class:r.attrs.class||"onboarding-gif"})}};var dr=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Pt=class{constructor(r){this.app=r.attrs.app}view(){return(0,st.default)(K,[(0,st.default)(Dt),(0,st.default)("p","Create animated GIFs from a screen recording."),(0,st.default)("p","Client-side only, no data is uploaded. Modern browser required."),dr?(0,st.default)("p","Sorry, mobile does not support screen recording."):void 0,dr?void 0:(0,st.default)(_,{label:"Start Recording",icon:"play",onclick:()=>this.app.startRecording(),primary:!0})])}};var ui=12;function St(n,r){if(n!==r)throw new Error("Invalid state")}var gr=class{constructor(){this.frameLength=Math.floor(1e3/ui);this._state={name:"start"};window.onbeforeunload=()=>this.state.name!=="start"?"":null}get state(){return this._state}set state(r){this._state=r,P.default.redraw()}view(){return(0,P.default)("section",{id:"app",class:this.state.name==="start"?"home":""},[(0,P.default)("section",{id:"app-body"},[(0,P.default)("h1",[(0,P.default)("span",{class:"gif"},"gif"),(0,P.default)("span",{class:"cap"},"cap")]),this.body()]),(0,P.default)("footer",{id:"app-footer"},[(0,P.default)("span.left",[(0,P.default)("a",{href:"https://github.com/joaomoreno/gifcap"},[(0,P.default)("img",{alt:"GitHub",src:"https://icongr.am/octicons/mark-github.svg?size=18&color=9e9e9e"})," joaomoreno/gifcap"])]),(0,P.default)("span",[(0,P.default)("a",{title:"Sponsor me!",href:"https://github.com/sponsors/joaomoreno"},[(0,P.default)("img",{alt:"GitHub",src:"https://icongr.am/material/coffee.svg?size=18&color=9e9e9e"})," Like the tool? Sponsor me!"])]),(0,P.default)("span.right",["Made with ",(0,P.default)("img",{alt:"love",src:"https://icongr.am/octicons/heart.svg?size=18&color=9e9e9e"})," by ",(0,P.default)("a",{href:"https://github.com/joaomoreno"},["Jo\xE3o Moreno"])])])])}body(){switch(this.state.name){case"start":return(0,P.default)(Pt,{app:this});case"playing":return(0,P.default)(Et,{app:this,gif:this.state.gif});case"recording":return(0,P.default)(qt,{app:this,captureStream:this.state.captureStream});case"previewing":return(0,P.default)(Ct,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions});case"rendering":return(0,P.default)(Tt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions})}}async startRecording(){try{let r=await navigator.mediaDevices.getDisplayMedia({video:{width:9999,height:9999}});this.state={name:"recording",captureStream:r},P.default.redraw.sync()}catch(r){console.error(r);return}}stopRecording(r){this.state={name:"previewing",recording:r}}startRendering(r){St(this.state.name,"previewing"),this.state={name:"rendering",recording:this.state.recording,renderOptions:r}}finishRendering(r){St(this.state.name,"rendering"),this.state={name:"playing",gif:r,recording:this.state.recording,renderOptions:this.state.renderOptions}}cancelRendering(){St(this.state.name,"rendering"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}editGif(){St(this.state.name,"playing"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}discardGif(){!window.confirm("This will discard the current recording, are you sure you want to continue?")||(this.state={name:"start"})}};function fi(){P.default.mount(document.getElementById("app-container"),gr)}fi();})();
//# sourceMappingURL=main.js.map
