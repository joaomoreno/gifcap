(()=>{var gr=Object.create;var Et=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var wr=Object.getOwnPropertyNames,de=Object.getOwnPropertySymbols,br=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty,vr=Object.prototype.propertyIsEnumerable;var ye=(n,r,a)=>r in n?Et(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a,Rt=(n,r)=>{for(var a in r||(r={}))ge.call(r,a)&&ye(n,a,r[a]);if(de)for(var a of de(r))vr.call(r,a)&&ye(n,a,r[a]);return n};var xr=n=>Et(n,"__esModule",{value:!0});var D=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var Mr=(n,r,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of wr(r))!ge.call(n,o)&&o!=="default"&&Et(n,o,{get:()=>r[o],enumerable:!(a=yr(r,o))||a.enumerable});return n},tt=n=>Mr(xr(Et(n!=null?gr(br(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var et=D((Qr,we)=>{"use strict";function ct(n,r,a,o,p,l){return{tag:n,key:r,attrs:a,children:o,text:p,dom:l,domSize:void 0,state:void 0,events:void 0,instance:void 0}}ct.normalize=function(n){return Array.isArray(n)?ct("[",void 0,void 0,ct.normalizeChildren(n),void 0,void 0):n==null||typeof n=="boolean"?null:typeof n=="object"?n:ct("#",void 0,void 0,String(n),void 0,void 0)};ct.normalizeChildren=function(n){var r=[];if(n.length){for(var a=n[0]!=null&&n[0].key!=null,o=1;o<n.length;o++)if((n[o]!=null&&n[o].key!=null)!==a)throw new TypeError("Vnodes must either always have keys or never have keys!");for(var o=0;o<n.length;o++)r[o]=ct.normalize(n[o])}return r};we.exports=ct});var Yt=D((Yr,be)=>{"use strict";var Cr=et();be.exports=function(){var n=arguments[this],r=this+1,a;if(n==null?n={}:(typeof n!="object"||n.tag!=null||Array.isArray(n))&&(n={},r=this),arguments.length===r+1)a=arguments[r],Array.isArray(a)||(a=[a]);else for(a=[];r<arguments.length;)a.push(arguments[r++]);return Cr("",n.key,n,a)}});var Zt=D((Zr,Ce)=>{"use strict";var ve=et(),Er=Yt(),Rr=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,xe={},ut={}.hasOwnProperty;function Me(n){for(var r in n)if(ut.call(n,r))return!1;return!0}function Ar(n){for(var r,a="div",o=[],p={};r=Rr.exec(n);){var l=r[1],h=r[2];if(l===""&&h!=="")a=h;else if(l==="#")p.id=h;else if(l===".")o.push(h);else if(r[3][0]==="["){var u=r[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?o.push(u):p[r[4]]=u===""?u:u||!0}}return o.length>0&&(p.className=o.join(" ")),xe[n]={tag:a,attrs:p}}function Or(n,r){var a=r.attrs,o=ve.normalizeChildren(r.children),p=ut.call(a,"class"),l=p?a.class:a.className;if(r.tag=n.tag,r.attrs=null,r.children=void 0,!Me(n.attrs)&&!Me(a)){var h={};for(var u in a)ut.call(a,u)&&(h[u]=a[u]);a=h}for(var u in n.attrs)ut.call(n.attrs,u)&&u!=="className"&&!ut.call(a,u)&&(a[u]=n.attrs[u]);(l!=null||n.attrs.className!=null)&&(a.className=l!=null?n.attrs.className!=null?String(n.attrs.className)+" "+String(l):l:n.attrs.className!=null?n.attrs.className:null),p&&(a.class=null);for(var u in a)if(ut.call(a,u)&&u!=="key"){r.attrs=a;break}return Array.isArray(o)&&o.length===1&&o[0]!=null&&o[0].tag==="#"?r.text=o[0].children:r.children=o,r}function Tr(n){if(n==null||typeof n!="string"&&typeof n!="function"&&typeof n.view!="function")throw Error("The selector must be either a string or a component.");var r=Er.apply(1,arguments);return typeof n=="string"&&(r.children=ve.normalizeChildren(r.children),n!=="[")?Or(xe[n]||Ar(n),r):(r.tag=n,r)}Ce.exports=Tr});var Re=D((ti,Ee)=>{"use strict";var Pr=et();Ee.exports=function(n){return n==null&&(n=""),Pr("<",void 0,void 0,n,void 0,void 0)}});var Oe=D((ei,Ae)=>{"use strict";var qr=et(),Dr=Yt();Ae.exports=function(){var n=Dr.apply(0,arguments);return n.tag="[",n.children=qr.normalizeChildren(n.children),n}});var Pe=D((ri,Te)=>{"use strict";var te=Zt();te.trust=Re();te.fragment=Oe();Te.exports=te});var ee=D((ii,qe)=>{"use strict";var k=function(n){if(!(this instanceof k))throw new Error("Promise must be called with `new`");if(typeof n!="function")throw new TypeError("executor must be a function");var r=this,a=[],o=[],p=f(a,!0),l=f(o,!1),h=r._instance={resolvers:a,rejectors:o},u=typeof setImmediate=="function"?setImmediate:setTimeout;function f(g,w){return function x(y){var M;try{if(w&&y!=null&&(typeof y=="object"||typeof y=="function")&&typeof(M=y.then)=="function"){if(y===r)throw new TypeError("Promise can't be resolved w/ itself");m(M.bind(y))}else u(function(){!w&&g.length===0&&console.error("Possible unhandled promise rejection:",y);for(var b=0;b<g.length;b++)g[b](y);a.length=0,o.length=0,h.state=w,h.retry=function(){x(y)}})}catch(b){l(b)}}}function m(g){var w=0;function x(M){return function(b){w++>0||M(b)}}var y=x(l);try{g(x(p),y)}catch(M){y(M)}}m(n)};k.prototype.then=function(n,r){var a=this,o=a._instance;function p(f,m,g,w){m.push(function(x){if(typeof f!="function")g(x);else try{l(f(x))}catch(y){h&&h(y)}}),typeof o.retry=="function"&&w===o.state&&o.retry()}var l,h,u=new k(function(f,m){l=f,h=m});return p(n,o.resolvers,l,!0),p(r,o.rejectors,h,!1),u};k.prototype.catch=function(n){return this.then(null,n)};k.prototype.finally=function(n){return this.then(function(r){return k.resolve(n()).then(function(){return r})},function(r){return k.resolve(n()).then(function(){return k.reject(r)})})};k.resolve=function(n){return n instanceof k?n:new k(function(r){r(n)})};k.reject=function(n){return new k(function(r,a){a(n)})};k.all=function(n){return new k(function(r,a){var o=n.length,p=0,l=[];if(n.length===0)r([]);else for(var h=0;h<n.length;h++)(function(u){function f(m){p++,l[u]=m,p===o&&r(l)}n[u]!=null&&(typeof n[u]=="object"||typeof n[u]=="function")&&typeof n[u].then=="function"?n[u].then(f,a):f(n[u])})(h)})};k.race=function(n){return new k(function(r,a){for(var o=0;o<n.length;o++)n[o].then(r,a)})};qe.exports=k});var re=D((ni,At)=>{"use strict";var wt=ee();typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=wt:window.Promise.prototype.finally||(window.Promise.prototype.finally=wt.prototype.finally),At.exports=window.Promise):typeof global!="undefined"?(typeof global.Promise=="undefined"?global.Promise=wt:global.Promise.prototype.finally||(global.Promise.prototype.finally=wt.prototype.finally),At.exports=global.Promise):At.exports=wt});var Le=D((ai,De)=>{"use strict";var ht=et();De.exports=function(n){var r=n&&n.document,a,o={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function p(e){return e.attrs&&e.attrs.xmlns||o[e.tag]}function l(e,t){if(e.state!==t)throw new Error("`vnode.state` must not be modified")}function h(e){var t=e.state;try{return this.apply(t,arguments)}finally{l(e,t)}}function u(){try{return r.activeElement}catch(e){return null}}function f(e,t,i,s,c,d,C){for(var E=i;E<s;E++){var v=t[E];v!=null&&m(e,v,c,C,d)}}function m(e,t,i,s,c){var d=t.tag;if(typeof d=="string")switch(t.state={},t.attrs!=null&&Bt(t.attrs,t,i),d){case"#":g(e,t,c);break;case"<":x(e,t,s,c);break;case"[":y(e,t,i,s,c);break;default:M(e,t,i,s,c)}else R(e,t,i,s,c)}function g(e,t,i){t.dom=r.createTextNode(t.children),st(e,t.dom,i)}var w={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function x(e,t,i,s){var c=t.children.match(/^\s*?<(\w+)/im)||[],d=r.createElement(w[c[1]]||"div");i==="http://www.w3.org/2000/svg"?(d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",d=d.firstChild):d.innerHTML=t.children,t.dom=d.firstChild,t.domSize=d.childNodes.length,t.instance=[];for(var C=r.createDocumentFragment(),E;E=d.firstChild;)t.instance.push(E),C.appendChild(E);st(e,C,s)}function y(e,t,i,s,c){var d=r.createDocumentFragment();if(t.children!=null){var C=t.children;f(d,C,0,C.length,i,null,s)}t.dom=d.firstChild,t.domSize=d.childNodes.length,st(e,d,c)}function M(e,t,i,s,c){var d=t.tag,C=t.attrs,E=C&&C.is;s=p(t)||s;var v=s?E?r.createElementNS(s,d,{is:E}):r.createElementNS(s,d):E?r.createElement(d,{is:E}):r.createElement(d);if(t.dom=v,C!=null&&or(t,C,s),st(e,v,c),!ot(t)&&(t.text!=null&&(t.text!==""?v.textContent=t.text:t.children=[ht("#",void 0,void 0,t.text,void 0,void 0)]),t.children!=null)){var O=t.children;f(v,O,0,O.length,i,null,s),t.tag==="select"&&C!=null&&lr(t,C)}}function b(e,t){var i;if(typeof e.tag.view=="function"){if(e.state=Object.create(e.tag),i=e.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(e.state=void 0,i=e.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,e.state=e.tag.prototype!=null&&typeof e.tag.prototype.view=="function"?new e.tag(e):e.tag(e)}if(Bt(e.state,e,t),e.attrs!=null&&Bt(e.attrs,e,t),e.instance=ht.normalize(h.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function R(e,t,i,s,c){b(t,i),t.instance!=null?(m(e,t.instance,i,s,c),t.dom=t.instance.dom,t.domSize=t.dom!=null?t.instance.domSize:0):t.domSize=0}function A(e,t,i,s,c,d){if(!(t===i||t==null&&i==null))if(t==null||t.length===0)f(e,i,0,i.length,s,c,d);else if(i==null||i.length===0)Q(e,t,0,t.length);else{var C=t[0]!=null&&t[0].key!=null,E=i[0]!=null&&i[0].key!=null,v=0,O=0;if(!C)for(;O<t.length&&t[O]==null;)O++;if(!E)for(;v<i.length&&i[v]==null;)v++;if(E===null&&C==null)return;if(C!==E)Q(e,t,O,t.length),f(e,i,v,i.length,s,c,d);else if(E){for(var H=t.length-1,j=i.length-1,Ct,B,V,$,P,Kt;H>=O&&j>=v&&($=t[H],P=i[j],$.key===P.key);)$!==P&&z(e,$,P,s,c,d),P.dom!=null&&(c=P.dom),H--,j--;for(;H>=O&&j>=v&&(B=t[O],V=i[v],B.key===V.key);)O++,v++,B!==V&&z(e,B,V,s,J(t,O,c),d);for(;H>=O&&j>=v&&!(v===j||B.key!==P.key||$.key!==V.key);)Kt=J(t,O,c),K(e,$,Kt),$!==V&&z(e,$,V,s,Kt,d),++v<=--j&&K(e,B,c),B!==P&&z(e,B,P,s,c,d),P.dom!=null&&(c=P.dom),O++,H--,$=t[H],P=i[j],B=t[O],V=i[v];for(;H>=O&&j>=v&&$.key===P.key;)$!==P&&z(e,$,P,s,c,d),P.dom!=null&&(c=P.dom),H--,j--,$=t[H],P=i[j];if(v>j)Q(e,t,O,H+1);else if(O>H)f(e,i,v,j+1,s,c,d);else{var dr=c,me=j-v+1,yt=new Array(me),Wt=0,L=0,Xt=2147483647,Jt=0,Ct,Qt;for(L=0;L<me;L++)yt[L]=-1;for(L=j;L>=v;L--){Ct==null&&(Ct=Z(t,O,H+1)),P=i[L];var ft=Ct[P.key];ft!=null&&(Xt=ft<Xt?ft:-1,yt[L-v]=ft,$=t[ft],t[ft]=null,$!==P&&z(e,$,P,s,c,d),P.dom!=null&&(c=P.dom),Jt++)}if(c=dr,Jt!==H-O+1&&Q(e,t,O,H+1),Jt===0)f(e,i,v,j+1,s,c,d);else if(Xt===-1)for(Qt=at(yt),Wt=Qt.length-1,L=j;L>=v;L--)V=i[L],yt[L-v]===-1?m(e,V,s,d,c):Qt[Wt]===L-v?Wt--:K(e,V,c),V.dom!=null&&(c=i[L].dom);else for(L=j;L>=v;L--)V=i[L],yt[L-v]===-1&&m(e,V,s,d,c),V.dom!=null&&(c=i[L].dom)}}else{var Gt=t.length<i.length?t.length:i.length;for(v=v<O?v:O;v<Gt;v++)B=t[v],V=i[v],!(B===V||B==null&&V==null)&&(B==null?m(e,V,s,d,J(t,v+1,c)):V==null?xt(e,B):z(e,B,V,s,J(t,v+1,c),d));t.length>Gt&&Q(e,t,v,t.length),i.length>Gt&&f(e,i,v,i.length,s,c,d)}}}function z(e,t,i,s,c,d){var C=t.tag,E=i.tag;if(C===E){if(i.state=t.state,i.events=t.events,mr(i,t))return;if(typeof C=="string")switch(i.attrs!=null&&Ut(i.attrs,i,s),C){case"#":it(t,i);break;case"<":nt(e,t,i,d,c);break;case"[":N(e,t,i,s,c,d);break;default:T(t,i,s,d)}else I(e,t,i,s,c,d)}else xt(e,t),m(e,i,s,d,c)}function it(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function nt(e,t,i,s,c){t.children!==i.children?(fe(e,t),x(e,i,s,c)):(i.dom=t.dom,i.domSize=t.domSize,i.instance=t.instance)}function N(e,t,i,s,c,d){A(e,t.children,i.children,s,c,d);var C=0,E=i.children;if(i.dom=null,E!=null){for(var v=0;v<E.length;v++){var O=E[v];O!=null&&O.dom!=null&&(i.dom==null&&(i.dom=O.dom),C+=O.domSize||1)}C!==1&&(i.domSize=C)}}function T(e,t,i,s){var c=t.dom=e.dom;s=p(t)||s,t.tag==="textarea"&&(t.attrs==null&&(t.attrs={}),t.text!=null&&(t.attrs.value=t.text,t.text=void 0)),fr(t,e.attrs,t.attrs,s),ot(t)||(e.text!=null&&t.text!=null&&t.text!==""?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(e.text!=null&&(e.children=[ht("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),t.text!=null&&(t.children=[ht("#",void 0,void 0,t.text,void 0,void 0)]),A(c,e.children,t.children,i,null,s)))}function I(e,t,i,s,c,d){if(i.instance=ht.normalize(h.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");Ut(i.state,i,s),i.attrs!=null&&Ut(i.attrs,i,s),i.instance!=null?(t.instance==null?m(e,i.instance,s,d,c):z(e,t.instance,i.instance,s,c,d),i.dom=i.instance.dom,i.domSize=i.instance.domSize):t.instance!=null?(xt(e,t.instance),i.dom=void 0,i.domSize=0):(i.dom=t.dom,i.domSize=t.domSize)}function Z(e,t,i){for(var s=Object.create(null);t<i;t++){var c=e[t];if(c!=null){var d=c.key;d!=null&&(s[d]=t)}}return s}var U=[];function at(e){for(var t=[0],i=0,s=0,c=0,d=U.length=e.length,c=0;c<d;c++)U[c]=e[c];for(var c=0;c<d;++c)if(e[c]!==-1){var C=t[t.length-1];if(e[C]<e[c]){U[c]=C,t.push(c);continue}for(i=0,s=t.length-1;i<s;){var E=(i>>>1)+(s>>>1)+(i&s&1);e[t[E]]<e[c]?i=E+1:s=E}e[c]<e[t[i]]&&(i>0&&(U[c]=t[i-1]),t[i]=c)}for(i=t.length,s=t[i-1];i-- >0;)t[i]=s,s=U[s];return U.length=0,t}function J(e,t,i){for(;t<e.length;t++)if(e[t]!=null&&e[t].dom!=null)return e[t].dom;return i}function K(e,t,i){var s=r.createDocumentFragment();vt(e,s,t),st(e,s,i)}function vt(e,t,i){for(;i.dom!=null&&i.dom.parentNode===e;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var s=0;s<i.instance.length;s++)t.appendChild(i.instance[s]);else if(i.tag!=="[")t.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var s=0;s<i.children.length;s++){var c=i.children[s];c!=null&&vt(e,t,c)}break}}function st(e,t,i){i!=null?e.insertBefore(t,i):e.appendChild(t)}function ot(e){if(e.attrs==null||e.attrs.contenteditable==null&&e.attrs.contentEditable==null)return!1;var t=e.children;if(t!=null&&t.length===1&&t[0].tag==="<"){var i=t[0].children;e.dom.innerHTML!==i&&(e.dom.innerHTML=i)}else if(e.text!=null||t!=null&&t.length!==0)throw new Error("Child node of a contenteditable must be trusted");return!0}function Q(e,t,i,s){for(var c=i;c<s;c++){var d=t[c];d!=null&&xt(e,d)}}function xt(e,t){var i=0,s=t.state,c,d;if(typeof t.tag!="string"&&typeof t.state.onbeforeremove=="function"){var C=h.call(t.state.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i=1,c=C)}if(t.attrs&&typeof t.attrs.onbeforeremove=="function"){var C=h.call(t.attrs.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i|=2,d=C)}if(l(t,s),!i)Mt(t),It(e,t);else{if(c!=null){var E=function(){i&1&&(i&=2,i||v())};c.then(E,E)}if(d!=null){var E=function(){i&2&&(i&=1,i||v())};d.then(E,E)}}function v(){l(t,s),Mt(t),It(e,t)}}function fe(e,t){for(var i=0;i<t.instance.length;i++)e.removeChild(t.instance[i])}function It(e,t){for(;t.dom!=null&&t.dom.parentNode===e;){if(typeof t.tag!="string"){if(t=t.instance,t!=null)continue}else if(t.tag==="<")fe(e,t);else{if(t.tag!=="["&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(t.children.length===1){if(t=t.children[0],t!=null)continue}else for(var i=0;i<t.children.length;i++){var s=t.children[i];s!=null&&It(e,s)}}break}}function Mt(e){if(typeof e.tag!="string"&&typeof e.state.onremove=="function"&&h.call(e.state.onremove,e),e.attrs&&typeof e.attrs.onremove=="function"&&h.call(e.attrs.onremove,e),typeof e.tag!="string")e.instance!=null&&Mt(e.instance);else{var t=e.children;if(Array.isArray(t))for(var i=0;i<t.length;i++){var s=t[i];s!=null&&Mt(s)}}}function or(e,t,i){for(var s in t)$t(e,s,null,t[s],i)}function $t(e,t,i,s,c){if(!(t==="key"||t==="is"||s==null||Ft(t)||i===s&&!ur(e,t)&&typeof s!="object")){if(t[0]==="o"&&t[1]==="n")return pe(e,t,s);if(t.slice(0,6)==="xlink:")e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),s);else if(t==="style")he(e.dom,i,s);else if(ue(e,t,c)){if(t==="value"&&((e.tag==="input"||e.tag==="textarea")&&e.dom.value===""+s&&e.dom===u()||e.tag==="select"&&i!==null&&e.dom.value===""+s||e.tag==="option"&&i!==null&&e.dom.value===""+s))return;e.tag==="input"&&t==="type"?e.dom.setAttribute(t,s):e.dom[t]=s}else typeof s=="boolean"?s?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute(t==="className"?"class":t,s)}}function cr(e,t,i,s){if(!(t==="key"||t==="is"||i==null||Ft(t)))if(t[0]==="o"&&t[1]==="n"&&!Ft(t))pe(e,t,void 0);else if(t==="style")he(e.dom,i,null);else if(ue(e,t,s)&&t!=="className"&&!(t==="value"&&(e.tag==="option"||e.tag==="select"&&e.dom.selectedIndex===-1&&e.dom===u()))&&!(e.tag==="input"&&t==="type"))e.dom[t]=null;else{var c=t.indexOf(":");c!==-1&&(t=t.slice(c+1)),i!==!1&&e.dom.removeAttribute(t==="className"?"class":t)}}function lr(e,t){if("value"in t)if(t.value===null)e.dom.selectedIndex!==-1&&(e.dom.value=null);else{var i=""+t.value;(e.dom.value!==i||e.dom.selectedIndex===-1)&&(e.dom.value=i)}"selectedIndex"in t&&$t(e,"selectedIndex",null,t.selectedIndex,void 0)}function fr(e,t,i,s){if(i!=null)for(var c in i)$t(e,c,t&&t[c],i[c],s);var d;if(t!=null)for(var c in t)(d=t[c])!=null&&(i==null||i[c]==null)&&cr(e,c,d,s)}function ur(e,t){return t==="value"||t==="checked"||t==="selectedIndex"||t==="selected"&&e.dom===u()||e.tag==="option"&&e.dom.parentNode===r.activeElement}function Ft(e){return e==="oninit"||e==="oncreate"||e==="onupdate"||e==="onremove"||e==="onbeforeremove"||e==="onbeforeupdate"}function ue(e,t,i){return i===void 0&&(e.tag.indexOf("-")>-1||e.attrs!=null&&e.attrs.is||t!=="href"&&t!=="list"&&t!=="form"&&t!=="width"&&t!=="height")&&t in e.dom}var hr=/[A-Z]/g;function pr(e){return"-"+e.toLowerCase()}function _t(e){return e[0]==="-"&&e[1]==="-"?e:e==="cssFloat"?"float":e.replace(hr,pr)}function he(e,t,i){if(t!==i)if(i==null)e.style.cssText="";else if(typeof i!="object")e.style.cssText=i;else if(t==null||typeof t!="object"){e.style.cssText="";for(var s in i){var c=i[s];c!=null&&e.style.setProperty(_t(s),String(c))}}else{for(var s in i){var c=i[s];c!=null&&(c=String(c))!==String(t[s])&&e.style.setProperty(_t(s),c)}for(var s in t)t[s]!=null&&i[s]==null&&e.style.removeProperty(_t(s))}}function Ht(){this._=a}Ht.prototype=Object.create(null),Ht.prototype.handleEvent=function(e){var t=this["on"+e.type],i;typeof t=="function"?i=t.call(e.currentTarget,e):typeof t.handleEvent=="function"&&t.handleEvent(e),this._&&e.redraw!==!1&&(0,this._)(),i===!1&&(e.preventDefault(),e.stopPropagation())};function pe(e,t,i){if(e.events!=null){if(e.events[t]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(e.events[t]==null&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i):(e.events[t]!=null&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(e.events=new Ht,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i)}function Bt(e,t,i){typeof e.oninit=="function"&&h.call(e.oninit,t),typeof e.oncreate=="function"&&i.push(h.bind(e.oncreate,t))}function Ut(e,t,i){typeof e.onupdate=="function"&&i.push(h.bind(e.onupdate,t))}function mr(e,t){do{if(e.attrs!=null&&typeof e.attrs.onbeforeupdate=="function"){var i=h.call(e.attrs.onbeforeupdate,e,t);if(i!==void 0&&!i)break}if(typeof e.tag!="string"&&typeof e.state.onbeforeupdate=="function"){var i=h.call(e.state.onbeforeupdate,e,t);if(i!==void 0&&!i)break}return!1}while(!1);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}return function(e,t,i){if(!e)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var s=[],c=u(),d=e.namespaceURI;e.vnodes==null&&(e.textContent=""),t=ht.normalizeChildren(Array.isArray(t)?t:[t]);var C=a;try{a=typeof i=="function"?i:void 0,A(e,e.vnodes,t,s,null,d==="http://www.w3.org/1999/xhtml"?void 0:d)}finally{a=C}e.vnodes=t,c!=null&&u()!==c&&typeof c.focus=="function"&&c.focus();for(var E=0;E<s.length;E++)s[E]()}}});var ie=D((si,Ve)=>{"use strict";Ve.exports=Le()(window)});var Ne=D((oi,ze)=>{"use strict";var Se=et();ze.exports=function(n,r,a){var o=[],p=!1,l=!1;function h(){if(p)throw new Error("Nested m.redraw.sync() call");p=!0;for(var m=0;m<o.length;m+=2)try{n(o[m],Se(o[m+1]),u)}catch(g){a.error(g)}p=!1}function u(){l||(l=!0,r(function(){l=!1,h()}))}u.sync=h;function f(m,g){if(g!=null&&g.view==null&&typeof g!="function")throw new TypeError("m.mount(element, component) expects a component, not a vnode");var w=o.indexOf(m);w>=0&&(o.splice(w,2),n(m,[],u)),g!=null&&(o.push(m,g),n(m,Se(g),u))}return{mount:f,redraw:u}}});var Ot=D((ci,je)=>{"use strict";var Lr=ie();je.exports=Ne()(Lr,requestAnimationFrame,console)});var ne=D((li,ke)=>{"use strict";ke.exports=function(n){if(Object.prototype.toString.call(n)!=="[object Object]")return"";var r=[];for(var a in n)o(a,n[a]);return r.join("&");function o(p,l){if(Array.isArray(l))for(var h=0;h<l.length;h++)o(p+"["+h+"]",l[h]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var h in l)o(p+"["+h+"]",l[h]);else r.push(encodeURIComponent(p)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}}});var ae=D((fi,Ie)=>{"use strict";Ie.exports=Object.assign||function(n,r){r&&Object.keys(r).forEach(function(a){n[a]=r[a]})}});var Tt=D((ui,$e)=>{"use strict";var Vr=ne(),Sr=ae();$e.exports=function(n,r){if(/:([^\/\.-]+)(\.{3})?:/.test(n))throw new SyntaxError("Template parameter names *must* be separated");if(r==null)return n;var a=n.indexOf("?"),o=n.indexOf("#"),p=o<0?n.length:o,l=a<0?p:a,h=n.slice(0,l),u={};Sr(u,r);var f=h.replace(/:([^\/\.-]+)(\.{3})?/g,function(b,R,A){return delete u[R],r[R]==null?b:A?r[R]:encodeURIComponent(String(r[R]))}),m=f.indexOf("?"),g=f.indexOf("#"),w=g<0?f.length:g,x=m<0?w:m,y=f.slice(0,x);a>=0&&(y+=n.slice(a,p)),m>=0&&(y+=(a<0?"?":"&")+f.slice(m,w));var M=Vr(u);return M&&(y+=(a<0&&m<0?"?":"&")+M),o>=0&&(y+=n.slice(o)),g>=0&&(y+=(o<0?"":"&")+f.slice(g)),y}});var _e=D((hi,Fe)=>{"use strict";var zr=Tt();Fe.exports=function(n,r,a){var o=0;function p(u){return new r(u)}p.prototype=r.prototype,p.__proto__=r;function l(u){return function(f,m){typeof f!="string"?(m=f,f=f.url):m==null&&(m={});var g=new r(function(M,b){u(zr(f,m.params),m,function(R){if(typeof m.type=="function")if(Array.isArray(R))for(var A=0;A<R.length;A++)R[A]=new m.type(R[A]);else R=new m.type(R);M(R)},b)});if(m.background===!0)return g;var w=0;function x(){--w==0&&typeof a=="function"&&a()}return y(g);function y(M){var b=M.then;return M.constructor=p,M.then=function(){w++;var R=b.apply(M,arguments);return R.then(x,function(A){if(x(),w===0)throw A}),y(R)},M}}}function h(u,f){for(var m in u.headers)if({}.hasOwnProperty.call(u.headers,m)&&f.test(m))return!0;return!1}return{request:l(function(u,f,m,g){var w=f.method!=null?f.method.toUpperCase():"GET",x=f.body,y=(f.serialize==null||f.serialize===JSON.serialize)&&!(x instanceof n.FormData),M=f.responseType||(typeof f.extract=="function"?"":"json"),b=new n.XMLHttpRequest,R=!1,A=b,z,it=b.abort;b.abort=function(){R=!0,it.call(this)},b.open(w,u,f.async!==!1,typeof f.user=="string"?f.user:void 0,typeof f.password=="string"?f.password:void 0),y&&x!=null&&!h(f,/^content-type$/i)&&b.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof f.deserialize!="function"&&!h(f,/^accept$/i)&&b.setRequestHeader("Accept","application/json, text/*"),f.withCredentials&&(b.withCredentials=f.withCredentials),f.timeout&&(b.timeout=f.timeout),b.responseType=M;for(var nt in f.headers)({}).hasOwnProperty.call(f.headers,nt)&&b.setRequestHeader(nt,f.headers[nt]);b.onreadystatechange=function(N){if(!R&&N.target.readyState===4)try{var T=N.target.status>=200&&N.target.status<300||N.target.status===304||/^file:\/\//i.test(u),I=N.target.response,Z;if(M==="json"?!N.target.responseType&&typeof f.extract!="function"&&(I=JSON.parse(N.target.responseText)):(!M||M==="text")&&I==null&&(I=N.target.responseText),typeof f.extract=="function"?(I=f.extract(N.target,f),T=!0):typeof f.deserialize=="function"&&(I=f.deserialize(I)),T)m(I);else{try{Z=N.target.responseText}catch(at){Z=I}var U=new Error(Z);U.code=N.target.status,U.response=I,g(U)}}catch(at){g(at)}},typeof f.config=="function"&&(b=f.config(b,f,u)||b,b!==A&&(z=b.abort,b.abort=function(){R=!0,z.call(this)})),x==null?b.send():typeof f.serialize=="function"?b.send(f.serialize(x)):x instanceof n.FormData?b.send(x):b.send(JSON.stringify(x))}),jsonp:l(function(u,f,m,g){var w=f.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+o++,x=n.document.createElement("script");n[w]=function(y){delete n[w],x.parentNode.removeChild(x),m(y)},x.onerror=function(){delete n[w],x.parentNode.removeChild(x),g(new Error("JSONP request failed"))},x.src=u+(u.indexOf("?")<0?"?":"&")+encodeURIComponent(f.callbackKey||"callback")+"="+encodeURIComponent(w),n.document.documentElement.appendChild(x)})}}});var Be=D((pi,He)=>{"use strict";var Nr=re(),jr=Ot();He.exports=_e()(window,Nr,jr.redraw)});var se=D((mi,Ue)=>{"use strict";Ue.exports=function(n){if(n===""||n==null)return{};n.charAt(0)==="?"&&(n=n.slice(1));for(var r=n.split("&"),a={},o={},p=0;p<r.length;p++){var l=r[p].split("="),h=decodeURIComponent(l[0]),u=l.length===2?decodeURIComponent(l[1]):"";u==="true"?u=!0:u==="false"&&(u=!1);var f=h.split(/\]\[?|\[/),m=o;h.indexOf("[")>-1&&f.pop();for(var g=0;g<f.length;g++){var w=f[g],x=f[g+1],y=x==""||!isNaN(parseInt(x,10));if(w===""){var h=f.slice(0,g).join();a[h]==null&&(a[h]=Array.isArray(m)?m.length:0),w=a[h]++}else if(w==="__proto__")break;if(g===f.length-1)m[w]=u;else{var M=Object.getOwnPropertyDescriptor(m,w);M!=null&&(M=M.value),M==null&&(m[w]=M=y?[]:{}),m=M}}}return o}});var Pt=D((di,Ge)=>{"use strict";var kr=se();Ge.exports=function(n){var r=n.indexOf("?"),a=n.indexOf("#"),o=a<0?n.length:a,p=r<0?o:r,l=n.slice(0,p).replace(/\/{2,}/g,"/");return l?(l[0]!=="/"&&(l="/"+l),l.length>1&&l[l.length-1]==="/"&&(l=l.slice(0,-1))):l="/",{path:l,params:r<0?{}:kr(n.slice(r+1,o))}}});var We=D((gi,Ke)=>{"use strict";var Ir=Pt();Ke.exports=function(n){var r=Ir(n),a=Object.keys(r.params),o=[],p=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,h,u){return h==null?"\\"+l:(o.push({k:h,r:u==="..."}),u==="..."?"(.*)":u==="."?"([^/]+)\\.":"([^/]+)"+(u||""))})+"$");return function(l){for(var h=0;h<a.length;h++)if(r.params[a[h]]!==l.params[a[h]])return!1;if(!o.length)return p.test(l.path);var u=p.exec(l.path);if(u==null)return!1;for(var h=0;h<o.length;h++)l.params[o[h].k]=o[h].r?u[h+1]:decodeURIComponent(u[h+1]);return!0}}});var Ye=D((yi,Qe)=>{"use strict";var $r=et(),Fr=Zt(),_r=re(),Hr=Tt(),Xe=Pt(),Br=We(),Je=ae(),oe={};Qe.exports=function(n,r){var a;function o(w,x,y){if(w=Hr(w,x),a!=null){a();var M=y?y.state:null,b=y?y.title:null;y&&y.replace?n.history.replaceState(M,b,g.prefix+w):n.history.pushState(M,b,g.prefix+w)}else n.location.href=g.prefix+w}var p=oe,l,h,u,f,m=g.SKIP={};function g(w,x,y){if(w==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var M=0,b=Object.keys(y).map(function(T){if(T[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(T))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:T,component:y[T],check:Br(T)}}),R=typeof setImmediate=="function"?setImmediate:setTimeout,A=_r.resolve(),z=!1,it;if(a=null,x!=null){var nt=Xe(x);if(!b.some(function(T){return T.check(nt)}))throw new ReferenceError("Default route doesn't match any known routes")}function N(){z=!1;var T=n.location.hash;g.prefix[0]!=="#"&&(T=n.location.search+T,g.prefix[0]!=="?"&&(T=n.location.pathname+T,T[0]!=="/"&&(T="/"+T)));var I=T.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(g.prefix.length),Z=Xe(I);Je(Z.params,n.history.state);function U(){if(I===x)throw new Error("Could not resolve default route "+x);o(x,null,{replace:!0})}at(0);function at(J){for(;J<b.length;J++)if(b[J].check(Z)){var K=b[J].component,vt=b[J].route,st=K,ot=f=function(Q){if(ot===f){if(Q===m)return at(J+1);l=Q!=null&&(typeof Q.view=="function"||typeof Q=="function")?Q:"div",h=Z.params,u=I,f=null,p=K.render?K:null,M===2?r.redraw():(M=2,r.redraw.sync())}};K.view||typeof K=="function"?(K={},ot(st)):K.onmatch?A.then(function(){return K.onmatch(Z.params,I,vt)}).then(ot,U):ot("div");return}U()}}return a=function(){z||(z=!0,R(N))},typeof n.history.pushState=="function"?(it=function(){n.removeEventListener("popstate",a,!1)},n.addEventListener("popstate",a,!1)):g.prefix[0]==="#"&&(a=null,it=function(){n.removeEventListener("hashchange",N,!1)},n.addEventListener("hashchange",N,!1)),r.mount(w,{onbeforeupdate:function(){return M=M?2:1,!(!M||oe===p)},oncreate:N,onremove:it,view:function(){if(!(!M||oe===p)){var T=[$r(l,h.key,h)];return p&&(T=p.render(T[0])),T}}})}return g.set=function(w,x,y){f!=null&&(y=y||{},y.replace=!0),f=null,o(w,x,y)},g.get=function(){return u},g.prefix="#!",g.Link={view:function(w){var x=w.attrs.options,y={},M,b;Je(y,w.attrs),y.selector=y.options=y.key=y.oninit=y.oncreate=y.onbeforeupdate=y.onupdate=y.onbeforeremove=y.onremove=null;var R=Fr(w.attrs.selector||"a",y,w.children);return(R.attrs.disabled=Boolean(R.attrs.disabled))?(R.attrs.href=null,R.attrs["aria-disabled"]="true",R.attrs.onclick=null):(M=R.attrs.onclick,b=R.attrs.href,R.attrs.href=g.prefix+b,R.attrs.onclick=function(A){var z;typeof M=="function"?z=M.call(A.currentTarget,A):M==null||typeof M!="object"||typeof M.handleEvent=="function"&&M.handleEvent(A),z!==!1&&!A.defaultPrevented&&(A.button===0||A.which===0||A.which===1)&&(!A.currentTarget.target||A.currentTarget.target==="_self")&&!A.ctrlKey&&!A.metaKey&&!A.shiftKey&&!A.altKey&&(A.preventDefault(),A.redraw=!1,g.set(b,null,x))}),R}},g.param=function(w){return h&&w!=null?h[w]:h},g}});var tr=D((wi,Ze)=>{"use strict";var Ur=Ot();Ze.exports=Ye()(window,Ur)});var Y=D((bi,ir)=>{"use strict";var qt=Pe(),er=Be(),rr=Ot(),F=function(){return qt.apply(this,arguments)};F.m=qt;F.trust=qt.trust;F.fragment=qt.fragment;F.mount=rr.mount;F.route=tr();F.render=ie();F.redraw=rr.redraw;F.request=er.request;F.jsonp=er.jsonp;F.parseQueryString=se();F.buildQueryString=ne();F.parsePathname=Pt();F.buildPathname=Tt();F.vnode=et();F.PromisePolyfill=ee();ir.exports=F});var q=tt(Y());var G=tt(Y());var bt=tt(Y()),_=class{view(r){return r.attrs.a?(0,bt.default)("a",Rt({class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`},r.attrs.a),[(0,bt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label]):(0,bt.default)("button",{class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`,onclick:r.attrs.onclick,title:r.attrs.title||r.attrs.label,disabled:r.attrs.disabled},[(0,bt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label])}};var ce=tt(Y());function Gr(n){let r=Math.floor(n/1e3),a=Math.floor(r/60),o=r%60,p=`${o<10?"0":""}${o}`;return`${a>0?`${a<10?"0":""}${a}`:"00"}:${p}`}var pt=class{view(r){return(0,ce.default)("span.tag.is-small",[(0,ce.default)("img",{src:"https://icongr.am/octicons/clock.svg?size=16&color=333333"}),Gr(r.attrs.duration)])}};var Dt=tt(Y()),W=class{view(r){return(0,Dt.default)("section",{class:"view"},[(0,Dt.default)("section",Rt({class:`content ${r.attrs.contentClass||""}`},r.attrs.contentProps||{}),r.children),(0,Dt.default)("section",{class:"actions"},r.attrs.actions)])}};function Kr(n){return n<1024?"1 KB":(n=Math.round(n/1024),n<1024?`${n} KB`:`${Math.floor(n/1024*100)/100} MB`)}function mt(n,r){return String(n).padStart(r,"0")}var Lt=class{constructor(r){this.app=r.attrs.app,this.gif=r.attrs.gif}view(){let r=new Date,a=`Recording ${mt(r.getFullYear(),4)}-${mt(r.getMonth()+1,2)}-${mt(r.getDate(),2)} at ${mt(r.getHours(),2)}.${mt(r.getMinutes(),2)}.${mt(r.getSeconds(),2)}.gif`,o=[(0,G.default)(_,{label:"Download",icon:"download",a:{href:this.gif.url,download:a,target:"_blank"},primary:!0}),(0,G.default)(_,{label:"Edit",icon:"pencil",onclick:()=>this.app.editGif()}),(0,G.default)(_,{label:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,G.default)(W,{actions:o},(0,G.default)(".recording-card",[(0,G.default)("a",{href:this.gif.url,download:a,target:"_blank"},[(0,G.default)("img.recording",{src:this.gif.url})]),(0,G.default)("footer",[(0,G.default)(pt,{duration:this.gif.duration}),(0,G.default)("span.tag.is-small",[(0,G.default)("a.recording-detail",{href:this.gif.url,download:a,target:"_blank"},[(0,G.default)("img",{src:"https://icongr.am/octicons/download.svg?size=16&color=333333"}),Kr(this.gif.size)])])])]))]}};var S=tt(Y());function dt(n,r,a=0,o=n.length-1){let p=o-a;if(p===0)return a;if(p===1)return r<n[o].timestamp?a:o;let l=Math.floor((o+a)/2),h=n[l].timestamp;return r===h?l:r<h?dt(n,r,a,l):dt(n,r,l,o)}var le=()=>null,X=window.devicePixelRatio||1,Vt=class{constructor(r){this.didDraw=!1;this.didResize=!1;var p,l;this.app=r.attrs.app,this.recording=r.attrs.recording,this.duration=this.recording.frames[this.recording.frames.length-1].timestamp+this.app.frameLength,this.mouse={x:0,y:0},this.viewport={width:0,height:0,top:0,left:0,scale:1};let a=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.start].timestamp:0,o=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.end].timestamp:this.duration;this.playback={head:a,start:a,offset:0,end:o,disposable:le},this.trim={start:a,end:o},this.crop=(l=(p=r.attrs.renderOptions)==null?void 0:p.crop)!=null?l:{top:0,left:0,width:this.recording.width,height:this.recording.height}}get isPlaying(){return this.playback.disposable!==le}async oncreate(r){this.sourceCanvas=r.dom.querySelector("canvas.source"),this.sourceCtx=this.sourceCanvas.getContext("2d"),this.canvas=r.dom.querySelector("canvas.target"),this.ctx=this.canvas.getContext("2d"),this.matrix=this.ctx.getTransform(),this.playbar=r.dom.querySelector(".playbar"),this.content=r.dom.querySelector(".content");let a=()=>this.onDidResize();window.addEventListener("resize",a),this.viewportDisposable=()=>window.removeEventListener("resize",a),this.onDidResize(),this.zoomToFit(),setTimeout(()=>this.play())}zoomToFit(){this.viewport.top=(this.recording.height-this.viewport.height*X)/-2,this.viewport.left=(this.recording.width-this.viewport.width*X)/-2,this.initialScale=Math.max(.1,Math.min(1,this.viewport.width*X*.95/this.recording.width,this.viewport.height*X*.95/this.recording.height))}onDidResize(){let r=Math.floor(this.content.clientWidth),a=Math.floor(this.content.clientHeight);this.viewport.left+=Math.round((r-this.viewport.width)/this.viewport.scale/2),this.viewport.top+=Math.round((a-this.viewport.height)/this.viewport.scale/2),this.viewport.width=r,this.viewport.height=a,this.didResize=!0,S.default.redraw()}onbeforeremove(){this.pause(),this.viewportDisposable()}view(){let r=[(0,S.default)(_,{title:this.isPlaying?"Pause":"Play",iconset:"material",icon:this.isPlaying?"pause":"play",primary:!0,onclick:()=>this.togglePlayPause()}),(0,S.default)(".playbar",[(0,S.default)("input",{type:"range",min:0,max:`${this.duration}`,value:`${this.playback.head}`,disabled:this.isPlaying,oninput:a=>this.onPlaybarInput(a)}),(0,S.default)(".trim-bar",{style:{left:`${this.trim.start*100/this.duration}%`,width:`${(this.trim.end-this.trim.start)*100/this.duration}%`}},[(0,S.default)(".trim-start",{onmousedown:a=>this.onTrimMouseDown("start",a)}),(0,S.default)(".trim-end",{onmousedown:a=>this.onTrimMouseDown("end",a)})])]),(0,S.default)(_,{label:"Render",icon:"gear",onclick:()=>this.startRendering(),primary:!0}),(0,S.default)(_,{title:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,S.default)(W,{actions:r,contentClass:"crop",contentProps:{onmousemove:a=>this.onMouseMove(a),onmousedown:a=>this.onMouseDown(a),oncontextmenu:a=>a.preventDefault()}},[(0,S.default)("canvas",{class:"source",width:this.recording.width,height:this.recording.height}),(0,S.default)("canvas",{class:"target",width:Math.floor(this.viewport.width*X),height:Math.floor(this.viewport.height*X),onwheel:a=>this.onContentWheel(a)})])]}onTrimMouseDown(r,a){a.preventDefault();let o=this.isPlaying,p=this.playback.head;this.pause();let l={width:this.playbar.clientWidth,screenX:a.screenX,head:r==="start"?this.trim.start:this.trim.end,min:r==="start"?0:this.trim.start+this.app.frameLength,max:r==="start"?this.trim.end-this.app.frameLength:this.duration},h=f=>{let m=f.screenX-l.screenX,g=l.head+Math.round(m*this.duration/l.width);this.playback.head=g,this.trim[r]=Math.max(l.min,Math.min(l.max,g)),S.default.redraw()},u=()=>{document.body.removeEventListener("mousemove",h),document.body.removeEventListener("mouseup",u),this.playback.start=this.trim.start,this.playback.end=this.trim.end,o?(this.playback.head=this.trim.start,this.play()):this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,p)),S.default.redraw()};document.body.addEventListener("mousemove",h),document.body.addEventListener("mouseup",u)}onContentWheel(r){r.preventDefault();let a=Math.pow(1.1,-r.deltaY/90);this.setScale(this.viewport.scale*a,this.mouse),this.drawFrame()}setScale(r,a={x:this.viewport.width/2,y:this.viewport.height/2}){r=Math.max(.2,Math.min(3,r));let o=r/this.viewport.scale,l=this.matrix.inverse().transformPoint({x:a.x*X,y:a.y*X});this.ctx.translate(l.x,l.y),this.ctx.scale(o,o),this.ctx.translate(-l.x,-l.y),this.matrix=this.ctx.getTransform(),this.viewport.scale=r}onMouseMove(r){this.mouse.x=r.clientX,this.mouse.y=r.clientY}onMouseDown(r){r.ctrlKey||r.metaKey||r.shiftKey||r.altKey||r.button>0?this.onViewportMove(r):this.onCrop(r)}onCrop(r){let a=this.matrix.inverse(),o=f=>{let m=a.transformPoint({x:f.clientX*X,y:f.clientY*X});return{x:Math.max(Math.min(Math.floor(m.x)-this.viewport.left,this.recording.width),0),y:Math.max(Math.min(Math.floor(m.y)-this.viewport.top,this.recording.height),0)}},p=o(r),l=!1,h=f=>{let m=o(f);this.crop.top=Math.floor(Math.max(0,Math.min(p.y,m.y))),this.crop.left=Math.floor(Math.max(0,Math.min(p.x,m.x))),this.crop.width=Math.floor(Math.min(this.recording.width-this.crop.left,Math.abs(p.x-m.x))),this.crop.height=Math.floor(Math.min(this.recording.height-this.crop.top,Math.abs(p.y-m.y))),l=!0,S.default.redraw()},u=f=>{f.preventDefault(),document.body.removeEventListener("mousemove",h),document.body.removeEventListener("mouseup",u),(!l||this.crop.width<10||this.crop.height<10)&&(this.crop.top=0,this.crop.left=0,this.crop.width=this.recording.width,this.crop.height=this.recording.height),S.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",h),document.body.addEventListener("mouseup",u)}onViewportMove(r){let a=this.matrix.inverse(),o=u=>{let f=a.transformPoint({x:u.clientX*X,y:u.clientY*X});return{x:Math.floor(f.x),y:Math.floor(f.y)}},p={top:this.viewport.top,left:this.viewport.left,point:o(r)},l=u=>{let f=o(u);this.viewport.top=p.top+f.y-p.point.y,this.viewport.left=p.left+f.x-p.point.x,S.default.redraw()},h=u=>{u.preventDefault(),document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",h),S.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",h)}onPlaybarInput(r){this.playback.head=r.target.valueAsNumber;let a=dt(this.recording.frames,this.playback.head);this.ctx.putImageData(this.recording.frames[a].imageData,0,0)}play(){this.playback.disposable();let r;this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let a=()=>{this.playback.head=this.playback.start+(Date.now()-this.playback.offset)%(this.playback.end-this.playback.start),S.default.redraw(),r=requestAnimationFrame(a)};r=requestAnimationFrame(a),this.playback.disposable=()=>cancelAnimationFrame(r)}onupdate(){this.didResize&&(this.ctx.setTransform(this.matrix),this.didResize=!1),this.drawFrame()}drawFrame(){!this.didDraw&&this.initialScale!==1&&this.setScale(this.initialScale);let r=dt(this.recording.frames,this.playback.head);this.sourceCtx.putImageData(this.recording.frames[r].imageData,0,0);let a=this.ctx.getTransform();this.ctx.setTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(a),this.ctx.drawImage(this.sourceCanvas,this.viewport.left,this.viewport.top),(this.crop.top!==0||this.crop.left!==0||this.crop.width!==this.recording.width||this.crop.height!==this.recording.height)&&(this.ctx.beginPath(),this.ctx.moveTo(this.viewport.left,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top),this.ctx.closePath(),this.ctx.moveTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.closePath(),this.ctx.fillStyle="#00000055",this.ctx.fill()),this.didDraw=!0}pause(){this.playback.disposable(),this.playback.disposable=le}togglePlayPause(){this.isPlaying?this.pause():this.play()}startRendering(){this.app.startRendering({trim:{start:dt(this.recording.frames,this.trim.start),end:dt(this.recording.frames,this.trim.end)},crop:this.crop})}};var rt=tt(Y());var St=class{constructor(r){this.startTime=0;this.width=0;this.height=0;this.frames=[];this.app=r.attrs.app,this.captureStream=r.attrs.captureStream}async oncreate(r){let a=r.dom.getElementsByTagName("video")[0],o=r.dom.getElementsByTagName("canvas")[0];a.srcObject=this.captureStream;let p=o.getContext("2d"),l=new Worker("/dist/ticker.js");l.postMessage(this.app.frameLength),l.onmessage=()=>{if(a.videoWidth===0)return;let m=this.startTime===0;if(m){let w=a.videoWidth,x=a.videoHeight;this.startTime=Date.now(),this.width=w,this.height=x,o.width=w,o.height=x}p.drawImage(a,0,0);let g=p.getImageData(0,0,this.width,this.height);this.frames.push({imageData:g,timestamp:m?0:Date.now()-this.startTime})};let h=setInterval(()=>rt.default.redraw(),this.app.frameLength),u=this.captureStream.getVideoTracks()[0],f=()=>this.stopRecording();u.addEventListener("ended",f),this._onbeforeremove=()=>{l.terminate(),clearInterval(h),u.removeEventListener("ended",f),u.stop()},rt.default.redraw()}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}view(){return[(0,rt.default)(W,[(0,rt.default)("p",[(0,rt.default)(pt,{duration:this.startTime===0?0:Date.now()-this.startTime})]),(0,rt.default)(_,{label:"Stop Recording",icon:"square-fill",onclick:()=>this.stopRecording()}),(0,rt.default)("canvas.hidden",{width:640,height:480}),(0,rt.default)("video.hidden",{autoplay:!0,playsinline:!0})])]}stopRecording(){this.app.stopRecording({width:this.width,height:this.height,frames:this.frames})}};var gt=tt(Y());var zt=class{constructor(r){this.progress=0;this.app=r.attrs.app,this.recording=r.attrs.recording,this.renderOptions=r.attrs.renderOptions}async oncreate(r){let a=new GifEncoder({width:this.renderOptions.crop.width,height:this.renderOptions.crop.height});a.on("progress",l=>{this.progress=l,gt.default.redraw()}),a.once("finished",l=>{let h=URL.createObjectURL(l),u=this.recording.frames[this.renderOptions.trim.end].timestamp-this.recording.frames[this.renderOptions.trim.start].timestamp+this.app.frameLength;this.app.finishRendering({blob:l,url:h,duration:u,size:l.size})});let o=r.dom.getElementsByTagName("canvas")[0].getContext("2d"),p=l=>{if(l>this.renderOptions.trim.end){this._onbeforeremove=()=>a.abort(),a.render();return}let h=this.recording.frames[l],u=h.imageData;o.putImageData(u,0,0),u=o.getImageData(this.renderOptions.crop.left,this.renderOptions.crop.top,this.renderOptions.crop.width,this.renderOptions.crop.height);let f=l<this.renderOptions.trim.end?this.recording.frames[l+1].timestamp-h.timestamp:this.app.frameLength;a.addFrame(u,f),setTimeout(()=>p(l+1),0)};p(this.renderOptions.trim.start)}view(){let r=[(0,gt.default)(_,{label:"Cancel",icon:"square-fill",onclick:()=>this.app.cancelRendering()})];return[(0,gt.default)(W,{actions:r},[(0,gt.default)("progress",{max:"1",value:this.progress,title:"Rendering..."},`Rendering: ${Math.floor(this.progress*100)}%`),(0,gt.default)("canvas.hidden",{width:this.recording.width,height:this.recording.height})])]}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}};var lt=tt(Y());var nr=tt(Y()),Nt=class{view(r){return(0,nr.default)("img",{src:r.attrs.src||"media/onboarding.gif",alt:r.attrs.alt||"Onboarding animation",class:r.attrs.class||"onboarding-gif"})}};var ar=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),jt=class{constructor(r){this.app=r.attrs.app}view(){return(0,lt.default)(W,[(0,lt.default)(Nt),(0,lt.default)("p","Create animated GIFs from a screen recording."),(0,lt.default)("p","Client-side only, no data is uploaded. Modern browser required."),ar?(0,lt.default)("p","Sorry, mobile does not support screen recording."):void 0,ar?void 0:(0,lt.default)(_,{label:"Start Recording",icon:"play",onclick:()=>this.app.startRecording(),primary:!0})])}};var Wr=12;function kt(n,r){if(n!==r)throw new Error("Invalid state")}var sr=class{constructor(){this.frameLength=Math.floor(1e3/Wr);this._state={name:"start"};window.onbeforeunload=()=>this.state.name!=="start"?"":null}get state(){return this._state}set state(r){this._state=r,q.default.redraw()}view(){return(0,q.default)("section",{id:"app",class:this.state.name==="start"?"home":""},[(0,q.default)("section",{id:"app-body"},[(0,q.default)("h1",[(0,q.default)("span",{class:"gif"},"gif"),(0,q.default)("span",{class:"cap"},"cap")]),this.body()]),(0,q.default)("footer",{id:"app-footer"},[(0,q.default)("span.left",[(0,q.default)("a",{href:"https://github.com/joaomoreno/gifcap"},[(0,q.default)("img",{alt:"GitHub",src:"https://icongr.am/octicons/mark-github.svg?size=18&color=9e9e9e"})," joaomoreno/gifcap"])]),(0,q.default)("span",[(0,q.default)("a",{title:"Sponsor me!",href:"https://github.com/sponsors/joaomoreno"},[(0,q.default)("img",{alt:"GitHub",src:"https://icongr.am/material/coffee.svg?size=18&color=9e9e9e"})," Like the tool? Sponsor me!"])]),(0,q.default)("span.right",["Made with ",(0,q.default)("img",{alt:"love",src:"https://icongr.am/octicons/heart.svg?size=18&color=9e9e9e"})," by ",(0,q.default)("a",{href:"https://github.com/joaomoreno"},["Jo\xE3o Moreno"])])])])}body(){switch(this.state.name){case"start":return(0,q.default)(jt,{app:this});case"playing":return(0,q.default)(Lt,{app:this,gif:this.state.gif});case"recording":return(0,q.default)(St,{app:this,captureStream:this.state.captureStream});case"previewing":return(0,q.default)(Vt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions});case"rendering":return(0,q.default)(zt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions})}}async startRecording(){try{let r=await navigator.mediaDevices.getDisplayMedia({video:{width:9999,height:9999}});this.state={name:"recording",captureStream:r},q.default.redraw.sync()}catch(r){console.error(r);return}}stopRecording(r){this.state={name:"previewing",recording:r}}startRendering(r){kt(this.state.name,"previewing"),this.state={name:"rendering",recording:this.state.recording,renderOptions:r}}finishRendering(r){kt(this.state.name,"rendering"),this.state={name:"playing",gif:r,recording:this.state.recording,renderOptions:this.state.renderOptions}}cancelRendering(){kt(this.state.name,"rendering"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}editGif(){kt(this.state.name,"playing"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}discardGif(){!window.confirm("This will discard the current recording, are you sure you want to continue?")||(this.state={name:"start"})}};function Xr(){q.default.mount(document.getElementById("app-container"),sr)}Xr();})();
//# sourceMappingURL=main.js.map
